"use strict";(self["webpackChunknonebot_plugin_gocqhttp_frontend"]=self["webpackChunknonebot_plugin_gocqhttp_frontend"]||[]).push([[794],{7794:(t,e,s)=>{s.r(e),s.d(e,{default:()=>it});var o=s(3673),n=s(2323);const l=(0,o._)("div",{class:"text-h5 q-px-md"},"进程状态",-1),r={key:1},i=(0,o._)("strong",null,"退出代码:",-1),a={class:"row justify-center"},c=(0,o.Uk)(" 日志条数"),u=(0,o.Uk)(" 重启次数"),d=(0,o.Uk)(" 显示登录二维码 "),p=(0,o.Uk)("刷新"),h=(0,o.Uk)("停止"),g=(0,o.Uk)("启动"),m=(0,o._)("div",{class:"text-body1 text-grey"},[(0,o._)("strong",null,"进程日志")],-1);function w(t,e,s,w,f,v){const _=(0,o.up)("q-img"),y=(0,o.up)("q-avatar"),q=(0,o.up)("q-icon"),W=(0,o.up)("q-chip"),k=(0,o.up)("q-card-section"),b=(0,o.up)("q-separator"),Z=(0,o.up)("running-process-status"),S=(0,o.up)("q-popup-proxy"),C=(0,o.up)("q-btn"),$=(0,o.up)("q-slide-transition"),P=(0,o.up)("q-card-actions"),x=(0,o.up)("q-card"),Q=(0,o.up)("logs-console"),U=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(U,{class:"row q-pa-md justify-center"},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{class:"col-12 col-md-4 shadow"},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{class:"q-pa-md row items-center justify-start"},{default:(0,o.w5)((()=>[(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Wm)(_,{src:`https://q1.qlogo.cn/g?b=qq&nk=${t.uin}&s=640`},null,8,["src"])])),_:1}),l,(0,o.Wm)(W,{color:"green"},{default:(0,o.w5)((()=>[(0,o.Wm)(q,{name:"person"}),(0,o.Uk)("帐号: "+(0,n.zw)(t.uin),1)])),_:1})])),_:1}),(0,o.Wm)(b),(0,o.Wm)($,null,{default:(0,o.w5)((()=>[t.status?((0,o.wg)(),(0,o.j4)(k,{key:0,class:"row justify-center items-center"},{default:(0,o.w5)((()=>["pid"in t.status.details?((0,o.wg)(),(0,o.j4)(Z,{key:0,status:t.status.details},null,8,["status"])):((0,o.wg)(),(0,o.iD)("div",r,[(0,o.Wm)(W,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,{icon:"error",color:"red","text-color":"white"}),i,(0,o._)("code",null,(0,n.zw)(t.status.details.code),1)])),_:1})])),(0,o._)("div",a,[(0,o.Wm)(W,{outline:"",color:"green"},{default:(0,o.w5)((()=>[(0,o.Wm)(q,{name:"description",color:"accent"}),c,(0,o._)("code",null,(0,n.zw)(t.status.total_logs)+"条",1)])),_:1}),(0,o.Wm)(W,{outline:"",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(q,{name:"restart_alt",color:"accent"}),u,(0,o._)("code",null,(0,n.zw)(t.status.restarts)+"次",1)])),_:1})]),t.status.qr_uri?((0,o.wg)(),(0,o.j4)($,{key:2,class:"q-ma-md"},{default:(0,o.w5)((()=>[(0,o.Wm)(C,{push:"",icon:"qr_code",color:"accent"},{default:(0,o.w5)((()=>[d,(0,o.Wm)(S,null,{default:(0,o.w5)((()=>[(0,o.Wm)(_,{width:"40vh",src:t.status.qr_uri},null,8,["src"])])),_:1})])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1})):(0,o.kq)("",!0)])),_:1}),(0,o.Wm)(b),(0,o.Wm)(P,{class:"justify-center"},{default:(0,o.w5)((()=>{var e;return[(0,o.Wm)(C,{flat:"",color:"primary",icon:"refresh",onClick:t.updateStatus},{default:(0,o.w5)((()=>[p])),_:1},8,["onClick"]),"running"==(null===(e=t.status)||void 0===e?void 0:e.status)?((0,o.wg)(),(0,o.j4)(C,{key:0,flat:"",color:"red",icon:"stop",onClick:t.stopProcess},{default:(0,o.w5)((()=>[h])),_:1},8,["onClick"])):((0,o.wg)(),(0,o.j4)(C,{key:1,flat:"",color:"green",icon:"play_arrow",onClick:t.startProcess},{default:(0,o.w5)((()=>[g])),_:1},8,["onClick"]))]})),_:1})])),_:1}),(0,o.Wm)(x,{class:"col-12 col-md-8 q-pa-md"},{default:(0,o.w5)((()=>[m,(0,o.Wm)(b,{spaced:""}),(0,o.Wm)(Q,{logs:t.logs},null,8,["logs"])])),_:1})])),_:1})}const f={class:"text-center"},v=(0,o._)("div",{class:"text-body1"},"CPU",-1),_={class:"text-body2"},y=(0,o._)("strong",null,"PID:",-1),q=(0,o._)("strong",null,"内存:",-1),W=(0,o._)("strong",null,"启动时间:",-1);function k(t,e,s,l,r,i){var a,c;const u=(0,o.up)("q-icon"),d=(0,o.up)("q-circular-progress"),p=(0,o.up)("q-avatar"),h=(0,o.up)("q-chip");return(0,o.wg)(),(0,o.iD)("div",f,[(0,o._)("div",null,[(0,o.Wm)(d,{"show-value":"",value:null===(a=t.status)||void 0===a?void 0:a.cpu_percent,size:"70px",color:"blue",class:"q-ma-sm"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{name:"developer_board",color:"accent",size:"30px"})])),_:1},8,["value"]),v,(0,o._)("code",_,(0,n.zw)(null===(c=t.status)||void 0===c?void 0:c.cpu_percent)+"%",1)]),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>{var e;return[(0,o.Wm)(p,{color:"blue",icon:"account_tree"}),y,(0,o._)("code",null,(0,n.zw)(null===(e=t.status)||void 0===e?void 0:e.pid),1)]})),_:1}),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>{var e,s;return[(0,o.Wm)(p,{color:"yellow",icon:"memory"}),q,(0,o._)("code",null,(0,n.zw)(((null!==(s=null===(e=t.status)||void 0===e?void 0:e.memory_used)&&void 0!==s?s:0)/Math.pow(1024,2)).toFixed(2))+"MB",1)]})),_:1}),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>{var e,s;return[(0,o.Wm)(p,{color:"green",icon:"timer"}),W,(0,o._)("code",null,(0,n.zw)(new Date(1e3*(null!==(s=null===(e=t.status)||void 0===e?void 0:e.start_time)&&void 0!==s?s:0)).toLocaleString()),1)]})),_:1})])}const b=(0,o.aZ)({props:{status:Object}});var Z=s(4260),S=s(6122),C=s(4554),$=s(7030),P=s(5096),x=s(7518),Q=s.n(x);const U=(0,Z.Z)(b,[["render",k]]),j=U;Q()(b,"components",{QCircularProgress:S.Z,QIcon:C.Z,QChip:$.Z,QAvatar:P.Z});const L={ref:"root",class:"logs"},z={key:0,class:"timestamp"},D={key:1,class:"level"},T=["innerHTML"];function A(t,e,s,l,r,i){const a=(0,o.up)("q-scroll-area");return(0,o.wg)(),(0,o.j4)(a,{class:"page-logs frameless scroll"},{default:(0,o.w5)((()=>[(0,o._)("div",L,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.logs,(e=>((0,o.wg)(),(0,o.iD)("div",{class:(0,n.C_)(["line",{start:t.isStartupLine(e)}]),key:e.time},[e.time?((0,o.wg)(),(0,o.iD)("code",z,(0,n.zw)(new Date(e.time).toUTCString()),1)):(0,o.kq)("",!0),e.level?((0,o.wg)(),(0,o.iD)("code",D,(0,n.zw)(e.level),1)):(0,o.kq)("",!0),(0,o._)("code",{innerHTML:t.renderLine(e),class:(0,n.C_)(t.lineLevel(e))},null,10,T)],2)))),128))],512)])),_:1})}var H=s(2381),I=s(6643),J=s.n(I),M=function(t,e,s,o){function n(t){return t instanceof s?t:new s((function(e){e(t)}))}return new(s||(s=Promise))((function(s,l){function r(t){try{a(o.next(t))}catch(e){l(e)}}function i(t){try{a(o["throw"](t))}catch(e){l(e)}}function a(t){t.done?s(t.value):n(t.value).then(r,i)}a((o=o.apply(t,e||[])).next())}))};const B="当前版本:",N=new(J()),R=(0,o.aZ)({data:()=>({start:B}),props:{logs:{type:Array,default:()=>[]}},methods:{renderLine(t){const e=N.ansi_to_html(t.message);return e},lineLevel(t){switch(t.level){case H.dJ.Debug:return"level-debug";case H.dJ.Info:return"level-info";case H.dJ.Warning:return"level-warn";case H.dJ.Error:return"level-error";case H.dJ.Fatal:return"level-fatal";default:return"stdout"}},isStartupLine(t){return t.message.startsWith(B)}},created(){this.$watch((()=>this.logs.length),(()=>M(this,void 0,void 0,(function*(){var t;const e=this.$refs.root,s=null===(t=e.parentElement)||void 0===t?void 0:t.parentElement,{scrollTop:n,clientHeight:l,scrollHeight:r}=s;Math.abs(n+l-r)<=1&&(yield(0,o.Y3)(),s.scrollTop=r)}))))}});var E=s(7704);const F=(0,Z.Z)(R,[["render",A]]),G=F;Q()(R,"components",{QScrollArea:E.Z});var O=function(t,e,s,o){function n(t){return t instanceof s?t:new s((function(e){e(t)}))}return new(s||(s=Promise))((function(s,l){function r(t){try{a(o.next(t))}catch(e){l(e)}}function i(t){try{a(o["throw"](t))}catch(e){l(e)}}function a(t){t.done?s(t.value):n(t.value).then(r,i)}a((o=o.apply(t,e||[])).next())}))};const Y=(0,o.aZ)({data:()=>({updateTimer:null,logWebsocket:null,status:null,logs:[]}),components:{RunningProcessStatus:j,LogsConsole:G},computed:{uin(){return+this.$route.params.uin}},methods:{updateStatus(){return O(this,void 0,void 0,(function*(){try{this.$q.loadingBar.start();const{data:t}=yield this.$api.processStatusApiUinProcessStatusGet(this.uin);this.status=t}catch(t){console.error(t)}finally{this.$q.loadingBar.stop()}}))},stopProcess(){return O(this,void 0,void 0,(function*(){try{this.$q.loading.show(),yield this.$api.processStopApiUinProcessDelete(this.uin),yield this.updateStatus()}catch(t){console.error(t)}finally{this.$q.loading.hide()}}))},startProcess(){return O(this,void 0,void 0,(function*(){try{this.$q.loading.show(),yield this.$api.processStartApiUinProcessPut(this.uin),yield this.updateStatus()}catch(t){console.error(t)}finally{this.$q.loading.hide()}}))},logHistory(){return O(this,void 0,void 0,(function*(){try{const{data:t}=yield this.$api.processLogsHistoryApiUinProcessLogsGet(this.uin);this.logs=t}catch(t){console.error(t)}}))},logRealtime(){if(this.logWebsocket&&this.logWebsocket.close(),Number.isNaN(this.uin))return;const t=new URL(`api/${this.uin}/process/logs`,location.href);t.protocol="https:"===t.protocol?"wss:":"ws:",this.logWebsocket=new WebSocket(t.href),this.logWebsocket.onmessage=({data:t})=>{const e=JSON.parse(t);this.logs.push(e)},this.logWebsocket.onclose=()=>{this.logWebsocket=null}}},created(){this.updateTimer=window.setInterval((()=>{this.updateStatus()}),3e3),this.$watch((()=>this.$route.params),(()=>O(this,void 0,void 0,(function*(){this.status=null,this.logs=[];try{this.$q.loading.show(),yield this.updateStatus(),yield this.logHistory(),this.logRealtime()}finally{this.$q.loading.hide()}}))),{immediate:!0})},beforeUnmount(){this.updateTimer&&window.clearInterval(this.updateTimer),this.logWebsocket&&this.logWebsocket.close()}});var K=s(4379),V=s(151),X=s(5589),tt=s(4027),et=s(5869),st=s(2471),ot=s(8240),nt=s(3944),lt=s(9367);const rt=(0,Z.Z)(Y,[["render",w]]),it=rt;Q()(Y,"components",{QPage:K.Z,QCard:V.Z,QCardSection:X.Z,QAvatar:P.Z,QImg:tt.Z,QChip:$.Z,QIcon:C.Z,QSeparator:et.Z,QSlideTransition:st.Z,QBtn:ot.Z,QPopupProxy:nt.Z,QCardActions:lt.Z})}}]);