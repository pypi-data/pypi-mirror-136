"use strict";(self["webpackChunknonebot_plugin_gocqhttp_frontend"]=self["webpackChunknonebot_plugin_gocqhttp_frontend"]||[]).push([[405],{7405:(t,e,o)=>{o.r(e),o.d(e,{default:()=>Wt});var l=o(3673),n=o(2323);const s={class:"row col-12 col-md-4"},a=(0,l._)("div",{class:"text-h5 q-px-md"},"进程状态",-1),i={key:1},u=(0,l._)("strong",null,"退出代码:",-1),r={class:"row justify-center"},c=(0,l.Uk)(" 日志条数"),d=(0,l.Uk)(" 重启次数"),p=(0,l.Uk)(" 显示登录二维码 "),m=(0,l.Uk)("刷新"),v=(0,l.Uk)("停止"),g=(0,l.Uk)("启动"),h=(0,l._)("div",{class:"text-body1 text-grey"},[(0,l._)("strong",null,"进程日志")],-1);function f(t,e,o,f,w,_){const W=(0,l.up)("q-img"),y=(0,l.up)("q-avatar"),q=(0,l.up)("q-icon"),k=(0,l.up)("q-chip"),b=(0,l.up)("q-card-section"),Z=(0,l.up)("q-separator"),Q=(0,l.up)("running-process-status"),U=(0,l.up)("q-popup-proxy"),P=(0,l.up)("q-btn"),S=(0,l.up)("q-slide-transition"),C=(0,l.up)("q-card-actions"),x=(0,l.up)("q-card"),$=(0,l.up)("message-sender"),A=(0,l.up)("logs-console"),j=(0,l.up)("q-page");return(0,l.wg)(),(0,l.j4)(j,{class:"row q-pa-md justify-center"},{default:(0,l.w5)((()=>[(0,l._)("div",s,[(0,l.Wm)(x,{class:"col-12 shadow"},{default:(0,l.w5)((()=>[(0,l.Wm)(b,{class:"q-pa-md row items-center justify-start"},{default:(0,l.w5)((()=>[(0,l.Wm)(y,null,{default:(0,l.w5)((()=>[(0,l.Wm)(W,{src:`https://q1.qlogo.cn/g?b=qq&nk=${t.uin}&s=640`},null,8,["src"])])),_:1}),a,(0,l.Wm)(k,{color:"green"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{name:"person"}),(0,l.Uk)("帐号: "+(0,n.zw)(t.uin),1)])),_:1})])),_:1}),(0,l.Wm)(Z),(0,l.Wm)(S,null,{default:(0,l.w5)((()=>[t.status?((0,l.wg)(),(0,l.j4)(b,{key:0,class:"row justify-center items-center"},{default:(0,l.w5)((()=>["pid"in t.status.details?((0,l.wg)(),(0,l.j4)(Q,{key:0,status:t.status.details},null,8,["status"])):((0,l.wg)(),(0,l.iD)("div",i,[(0,l.Wm)(k,null,{default:(0,l.w5)((()=>[(0,l.Wm)(y,{icon:"error",color:"red","text-color":"white"}),u,(0,l._)("code",null,(0,n.zw)(t.status.details.code),1)])),_:1})])),(0,l._)("div",r,[(0,l.Wm)(k,{outline:"",color:"green"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{name:"description",color:"accent"}),c,(0,l._)("code",null,(0,n.zw)(t.status.total_logs)+"条",1)])),_:1}),(0,l.Wm)(k,{outline:"",color:"red"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{name:"restart_alt",color:"accent"}),d,(0,l._)("code",null,(0,n.zw)(t.status.restarts)+"次",1)])),_:1})]),t.status.qr_uri?((0,l.wg)(),(0,l.j4)(S,{key:2,class:"q-ma-md"},{default:(0,l.w5)((()=>[(0,l.Wm)(P,{push:"",icon:"qr_code",color:"accent"},{default:(0,l.w5)((()=>[p,(0,l.Wm)(U,null,{default:(0,l.w5)((()=>[(0,l.Wm)(W,{width:"40vh",src:t.status.qr_uri},null,8,["src"])])),_:1})])),_:1})])),_:1})):(0,l.kq)("",!0)])),_:1})):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(Z),(0,l.Wm)(C,{class:"justify-center"},{default:(0,l.w5)((()=>{var e;return[(0,l.Wm)(P,{flat:"",color:"primary",icon:"refresh",onClick:t.updateStatus},{default:(0,l.w5)((()=>[m])),_:1},8,["onClick"]),"running"==(null===(e=t.status)||void 0===e?void 0:e.status)?((0,l.wg)(),(0,l.j4)(P,{key:0,flat:"",color:"red",icon:"stop",onClick:t.stopProcess},{default:(0,l.w5)((()=>[v])),_:1},8,["onClick"])):((0,l.wg)(),(0,l.j4)(P,{key:1,flat:"",color:"green",icon:"play_arrow",onClick:t.startProcess},{default:(0,l.w5)((()=>[g])),_:1},8,["onClick"]))]})),_:1})])),_:1}),(0,l.Wm)($,{class:"col-12 shadow",uin:t.uin},null,8,["uin"])]),(0,l.Wm)(x,{class:"col-12 col-md-8 q-pa-md"},{default:(0,l.w5)((()=>[h,(0,l.Wm)(Z,{spaced:""}),(0,l.Wm)(A,{logs:t.logs},null,8,["logs"])])),_:1})])),_:1})}const w={class:"text-center"},_=(0,l._)("div",{class:"text-body1"},"CPU",-1),W={class:"text-body2"},y=(0,l._)("strong",null,"PID:",-1),q=(0,l._)("strong",null,"内存:",-1),k=(0,l._)("strong",null,"启动时间:",-1),b=(0,l.aZ)({props:{status:{type:Object,required:!0}},setup(t){return(e,o)=>{var s,a;const i=(0,l.up)("q-icon"),u=(0,l.up)("q-circular-progress"),r=(0,l.up)("q-avatar"),c=(0,l.up)("q-chip");return(0,l.wg)(),(0,l.iD)("div",w,[(0,l._)("div",null,[(0,l.Wm)(u,{"show-value":"",value:null===(s=t.status)||void 0===s?void 0:s.cpu_percent,"track-color":e.$q.dark.isActive?"grey-8":"grey-3",thickness:.1,size:"90px",color:"blue",class:"q-ma-sm"},{default:(0,l.w5)((()=>[(0,l.Wm)(i,{name:"developer_board",color:"accent",size:"30px"})])),_:1},8,["value","track-color","thickness"]),_,(0,l._)("code",W,(0,n.zw)(null===(a=t.status)||void 0===a?void 0:a.cpu_percent)+"%",1)]),(0,l.Wm)(c,null,{default:(0,l.w5)((()=>{var e;return[(0,l.Wm)(r,{color:"blue",icon:"account_tree"}),y,(0,l._)("code",null,(0,n.zw)(null===(e=t.status)||void 0===e?void 0:e.pid),1)]})),_:1}),(0,l.Wm)(c,null,{default:(0,l.w5)((()=>{var e,o;return[(0,l.Wm)(r,{color:"yellow",icon:"memory"}),q,(0,l._)("code",null,(0,n.zw)(((null!==(o=null===(e=t.status)||void 0===e?void 0:e.memory_used)&&void 0!==o?o:0)/Math.pow(1024,2)).toFixed(2))+"MB",1)]})),_:1}),(0,l.Wm)(c,null,{default:(0,l.w5)((()=>{var e,o;return[(0,l.Wm)(r,{color:"green",icon:"timer"}),k,(0,l._)("code",null,(0,n.zw)(new Date(1e3*(null!==(o=null===(e=t.status)||void 0===e?void 0:e.start_time)&&void 0!==o?o:0)).toLocaleString()),1)]})),_:1})])}}});var Z=o(6122),Q=o(4554),U=o(7030),P=o(5096),S=o(7518),C=o.n(S);const x=b,$=x;C()(b,"components",{QCircularProgress:Z.Z,QIcon:Q.Z,QChip:U.Z,QAvatar:P.Z});var A=o(1959),j=o(2381),z=o(6643),H=o.n(z),V=function(t,e,o,l){function n(t){return t instanceof o?t:new o((function(e){e(t)}))}return new(o||(o=Promise))((function(o,s){function a(t){try{u(l.next(t))}catch(e){s(e)}}function i(t){try{u(l["throw"](t))}catch(e){s(e)}}function u(t){t.done?o(t.value):n(t.value).then(a,i)}u((l=l.apply(t,e||[])).next())}))};const T={key:0,class:"timestamp"},I={key:1,class:"level"},D=["innerHTML"],L=(0,l.aZ)({props:{logs:{type:Array,default:()=>[]}},setup(t){const e=t,o="当前版本:",s=new(H()),a=(0,A.iH)();function i(t){const e=s.ansi_to_html(t.message);return e}function u(t){switch(t.level){case j.dJ.Debug:return"level-debug";case j.dJ.Info:return"level-info";case j.dJ.Warning:return"level-warn";case j.dJ.Error:return"level-error";case j.dJ.Fatal:return"level-fatal";default:return"stdout"}}return(0,l.YP)((()=>e.logs.length),(()=>V(this,void 0,void 0,(function*(){var t,e;const o=null===(e=null===(t=a.value)||void 0===t?void 0:t.parentElement)||void 0===e?void 0:e.parentElement;if(!o)return;const{scrollTop:n,clientHeight:s,scrollHeight:i}=o;Math.abs(n+s-i)<=1&&(yield(0,l.Y3)(),o.scrollTop=i)})))),(e,s)=>{const r=(0,l.up)("q-scroll-area");return(0,l.wg)(),(0,l.j4)(r,{class:"page-logs"},{default:(0,l.w5)((()=>[(0,l._)("div",{ref_key:"root",ref:a,class:"logs rounded-borders"},[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(t.logs,(t=>((0,l.wg)(),(0,l.iD)("div",{class:(0,n.C_)(["line",{start:t.message.startsWith(o)}]),key:t.time},[t.time?((0,l.wg)(),(0,l.iD)("code",T,(0,n.zw)(new Date(t.time).toUTCString()),1)):(0,l.kq)("",!0),t.level?((0,l.wg)(),(0,l.iD)("code",I,(0,n.zw)(t.level),1)):(0,l.kq)("",!0),(0,l._)("code",{innerHTML:i(t),class:(0,n.C_)(u(t))},null,10,D)],2)))),128))],512)])),_:1})}}});var F=o(7704);const J=L,M=J;C()(L,"components",{QScrollArea:F.Z});var B=o(1768),N=function(t,e,o,l){function n(t){return t instanceof o?t:new o((function(e){e(t)}))}return new(o||(o=Promise))((function(o,s){function a(t){try{u(l.next(t))}catch(e){s(e)}}function i(t){try{u(l["throw"](t))}catch(e){s(e)}}function u(t){t.done?o(t.value):n(t.value).then(a,i)}u((l=l.apply(t,e||[])).next())}))};const R=(0,l.Uk)("没有群"),E=(0,l.Uk)("没有好友"),O=(0,l.aZ)({props:{uin:{type:Number,required:!0}},setup(t){const e=t,o=(0,A.iH)("group"),s=(0,A.iH)(),a=(0,A.iH)([]),i=(0,A.iH)(),u=(0,A.iH)([]),r=(0,A.iH)();function c(){return N(this,void 0,void 0,(function*(){const{data:t}=yield B.api.accountApiApiUinApiPost(e.uin,"get_group_list",{no_cache:!0});return t}))}function d(){return N(this,void 0,void 0,(function*(){const{data:t}=yield B.api.accountApiApiUinApiPost(e.uin,"get_friend_list",{no_cache:!0});return t}))}function p(t,o){return N(this,void 0,void 0,(function*(){const{data:l}=yield B.api.accountApiApiUinApiPost(e.uin,"send_msg",Object.assign({message:t},o));return l}))}return(t,e)=>{const m=(0,l.up)("q-tab"),v=(0,l.up)("q-tabs"),g=(0,l.up)("q-separator"),h=(0,l.up)("q-img"),f=(0,l.up)("q-avatar"),w=(0,l.up)("q-item-section"),_=(0,l.up)("q-item-label"),W=(0,l.up)("q-item"),y=(0,l.up)("q-select"),q=(0,l.up)("q-btn"),k=(0,l.up)("q-tab-panel"),b=(0,l.up)("q-tab-panels"),Z=(0,l.up)("q-input"),Q=(0,l.up)("q-card-section"),U=(0,l.up)("q-card");return(0,l.wg)(),(0,l.j4)(U,null,{default:(0,l.w5)((()=>[(0,l.Wm)(v,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value=t),"active-color":"primary"},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{name:"group",label:"群聊",icon:"groups"}),(0,l.Wm)(m,{name:"friend",label:"好友",icon:"chat"})])),_:1},8,["modelValue"]),(0,l.Wm)(g),(0,l.Wm)(b,{modelValue:o.value,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value=t),animated:""},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{name:"group",class:"row justify-evenly"},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{class:"col-8",modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value=t),filled:"",onFilter:e[2]||(e[2]=(t,e,o)=>c().then((t=>e((()=>a.value=t))))),options:a.value,"option-label":"group_name","option-value":"group_id",label:"选择群聊","map-options":"","emit-value":""},{option:(0,l.w5)((t=>[(0,l.Wm)(W,(0,n.vs)((0,l.F4)(t.itemProps)),{default:(0,l.w5)((()=>[(0,l.Wm)(w,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(f,null,{default:(0,l.w5)((()=>[(0,l.Wm)(h,{src:`http://p.qlogo.cn/gh/${t.opt.group_id}/${t.opt.group_id}/100/`},null,8,["src"])])),_:2},1024)])),_:2},1024),(0,l.Wm)(w,null,{default:(0,l.w5)((()=>[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(t.opt.group_name),1)])),_:2},1024),(0,l.Wm)(_,{caption:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(t.opt.group_id),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),"no-option":(0,l.w5)((()=>[(0,l.Wm)(W,null,{default:(0,l.w5)((()=>[(0,l.Wm)(w,{class:"text-grey"},{default:(0,l.w5)((()=>[R])),_:1})])),_:1})])),_:1},8,["modelValue","options"]),(0,l.Wm)(q,{class:"col-2",flat:"",icon:"send",color:"indigo",disable:!(s.value&&i.value),onClick:e[3]||(e[3]=t=>p(s.value,{group_id:i.value}).then((()=>{s.value=void 0})))},null,8,["disable"])])),_:1}),(0,l.Wm)(k,{name:"friend",class:"row justify-evenly"},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{class:"col-8",modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=t=>r.value=t),filled:"",onFilter:e[5]||(e[5]=(t,e,o)=>d().then((t=>e((()=>u.value=t))))),options:u.value,"option-label":"nickname","option-value":"user_id",label:"选择好友","map-options":"","emit-value":""},{option:(0,l.w5)((t=>[(0,l.Wm)(W,(0,n.vs)((0,l.F4)(t.itemProps)),{default:(0,l.w5)((()=>[(0,l.Wm)(w,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(f,null,{default:(0,l.w5)((()=>[(0,l.Wm)(h,{src:`https://q1.qlogo.cn/g?b=qq&nk=${t.opt.user_id}&s=640`},null,8,["src"])])),_:2},1024)])),_:2},1024),(0,l.Wm)(w,null,{default:(0,l.w5)((()=>[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(t.opt.nickname),1)])),_:2},1024),(0,l.Wm)(_,{caption:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(t.opt.user_id),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),"no-option":(0,l.w5)((()=>[(0,l.Wm)(W,null,{default:(0,l.w5)((()=>[(0,l.Wm)(w,{class:"text-grey"},{default:(0,l.w5)((()=>[E])),_:1})])),_:1})])),_:1},8,["modelValue","options"]),(0,l.Wm)(q,{class:"col-2",flat:"",icon:"send",color:"deep-orange",disable:!(s.value&&r.value),onClick:e[6]||(e[6]=t=>p(s.value,{user_id:r.value}).then((()=>{s.value=void 0})))},null,8,["disable"])])),_:1})])),_:1},8,["modelValue"]),(0,l.Wm)(Q,null,{default:(0,l.w5)((()=>[(0,l.Wm)(Z,{modelValue:s.value,"onUpdate:modelValue":e[8]||(e[8]=t=>s.value=t),style:{height:"15vh"},autogrow:"",outlined:"",label:"消息正文",rules:[t=>!!String(t).trim()||"请输入消息正文"]},null,8,["modelValue","rules"])])),_:1})])),_:1})}}});var Y=o(151),G=o(7547),K=o(3269),X=o(5869),tt=o(5906),et=o(6602),ot=o(7757),lt=o(3414),nt=o(2035),st=o(4027),at=o(2350),it=o(8240),ut=o(5589),rt=o(4842);const ct=O,dt=ct;C()(O,"components",{QCard:Y.Z,QTabs:G.Z,QTab:K.Z,QSeparator:X.Z,QTabPanels:tt.Z,QTabPanel:et.Z,QSelect:ot.Z,QItem:lt.Z,QItemSection:nt.Z,QAvatar:P.Z,QImg:st.Z,QItemLabel:at.Z,QBtn:it.Z,QCardSection:ut.Z,QInput:rt.Z});var pt=function(t,e,o,l){function n(t){return t instanceof o?t:new o((function(e){e(t)}))}return new(o||(o=Promise))((function(o,s){function a(t){try{u(l.next(t))}catch(e){s(e)}}function i(t){try{u(l["throw"](t))}catch(e){s(e)}}function u(t){t.done?o(t.value):n(t.value).then(a,i)}u((l=l.apply(t,e||[])).next())}))};const mt=(0,l.aZ)({data:()=>({updateTimer:null,logWebsocket:null,status:null,logs:[]}),components:{RunningProcessStatus:$,LogsConsole:M,MessageSender:dt},computed:{uin(){return+this.$route.params.uin}},methods:{updateStatus(){return pt(this,void 0,void 0,(function*(){this.logWebsocket&&this.logWebsocket.send("heartbeat");try{this.$q.loadingBar.start();const{data:t}=yield this.$api.processStatusApiUinProcessStatusGet(this.uin);this.status=t}catch(t){console.error(t)}finally{this.$q.loadingBar.stop()}}))},stopProcess(){return pt(this,void 0,void 0,(function*(){try{this.$q.loading.show(),yield this.$api.processStopApiUinProcessDelete(this.uin),yield this.updateStatus()}catch(t){console.error(t)}finally{this.$q.loading.hide()}}))},startProcess(){return pt(this,void 0,void 0,(function*(){try{this.$q.loading.show(),yield this.$api.processStartApiUinProcessPut(this.uin),yield this.updateStatus()}catch(t){console.error(t)}finally{this.$q.loading.hide()}}))},logHistory(){return pt(this,void 0,void 0,(function*(){try{const{data:t}=yield this.$api.processLogsHistoryApiUinProcessLogsGet(this.uin);this.logs=t}catch(t){console.error(t)}}))},logRealtime(){if(this.logWebsocket&&this.logWebsocket.close(),Number.isNaN(this.uin))return;const t=new URL(`api/${this.uin}/process/logs`,location.href);t.protocol="https:"===t.protocol?"wss:":"ws:",this.logWebsocket=new WebSocket(t.href),this.logWebsocket.onmessage=({data:t})=>{const e=JSON.parse(t);this.logs.push(e)},this.logWebsocket.onclose=()=>{this.logWebsocket=null}}},created(){this.updateTimer=window.setInterval((()=>{this.updateStatus()}),3e3),this.$watch((()=>this.$route.params),(()=>pt(this,void 0,void 0,(function*(){this.status=null,this.logs=[];try{this.$q.loading.show(),yield this.updateStatus(),yield this.logHistory(),this.logRealtime()}finally{this.$q.loading.hide()}}))),{immediate:!0})},beforeUnmount(){this.updateTimer&&window.clearInterval(this.updateTimer),this.logWebsocket&&this.logWebsocket.close()}});var vt=o(4260),gt=o(4379),ht=o(2471),ft=o(3944),wt=o(9367);const _t=(0,vt.Z)(mt,[["render",f]]),Wt=_t;C()(mt,"components",{QPage:gt.Z,QCard:Y.Z,QCardSection:ut.Z,QAvatar:P.Z,QImg:st.Z,QChip:U.Z,QIcon:Q.Z,QSeparator:X.Z,QSlideTransition:ht.Z,QBtn:it.Z,QPopupProxy:ft.Z,QCardActions:wt.Z})}}]);
//# sourceMappingURL=405.3918a0a1.js.map