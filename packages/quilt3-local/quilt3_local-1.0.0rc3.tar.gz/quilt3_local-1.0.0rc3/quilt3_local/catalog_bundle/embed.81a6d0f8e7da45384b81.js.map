{"version":3,"file":"embed.81a6d0f8e7da45384b81.js","mappings":"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","sources":["webpack://quilt-navigator/./app/embed/Overrides.tsx","webpack://quilt-navigator/./app/embed/ipc.ts","webpack://quilt-navigator/./app/embed/EmbedConfig.js","webpack://quilt-navigator/./app/constants/embed-routes.js","webpack://quilt-navigator/./app/embed/AppBar.js","webpack://quilt-navigator/./app/embed/Embed.js","webpack://quilt-navigator/./app/embed/index.js"],"sourcesContent":["import template from 'lodash/template'\nimport * as R from 'ramda'\nimport * as React from 'react'\n\n// XXX: consider using io-ts\ninterface S3ObjectLinkOverride {\n  title?: React.ReactNode\n  href?: (ctx: {\n    url: string\n    s3HttpsUri: string\n    bucket: string\n    // TODO: add encoded key?\n    key: string\n    version: string\n  }) => string\n  notification?: React.ReactNode\n  emit?: 'notify' | 'override'\n}\n\ninterface Overrides {\n  s3ObjectLink?: S3ObjectLinkOverride\n}\n\nexport const Context = React.createContext<Overrides>({})\nContext.displayName = 'Overrides'\n\nexport const { Provider } = Context\n\nfunction merge<L extends any, R extends any>(l: L, r: R) {\n  return l ?? r\n}\n\nexport function useOverrides(defaults?: Overrides): Overrides {\n  const overrides = React.useContext(Context)\n  return React.useMemo(\n    () => compile(R.mergeDeepWith(merge, overrides, defaults || {})),\n    [defaults, overrides],\n  )\n}\n\nexport { useOverrides as use }\n\nfunction assertIsObject(scope: string, obj: unknown): asserts obj is object {\n  if (obj != null && typeof obj !== 'object') {\n    throw new Error(`${scope} must be an object if present`)\n  }\n}\n\nconst compileTemplate = (scope?: string) => (str?: unknown) => {\n  try {\n    return typeof str === 'string'\n      ? template(str)\n      : (str as NonNullable<Overrides['s3ObjectLink']>['href'])\n  } catch (e) {\n    if (scope && e instanceof Error) {\n      throw new Error(`${scope} must be a valid template string: ${e.message}`)\n    }\n    throw e\n  }\n}\n\nfunction validateEmit(v: unknown) {\n  if (!v) return undefined\n  if (v !== 'notify' && v !== 'override') {\n    throw new Error(\n      '.overrides.s3ObjectLink.emit must be either \"notify\" or \"override\" or some falsy value',\n    )\n  }\n  return v\n}\n\nconst compile = R.evolve({\n  s3ObjectLink: { href: compileTemplate(), emit: validateEmit },\n})\n\nexport function validate(input: unknown) {\n  assertIsObject('.overrides', input)\n  assertIsObject('.overrides.s3ObjectLink', (input as any)?.s3ObjectLink)\n  R.evolve({\n    s3ObjectLink: {\n      href: compileTemplate('.overrides.s3ObjectLink.href'),\n      emit: validateEmit,\n    },\n  })(input)\n}\n","import * as React from 'react'\n\nimport parseSearch from 'utils/parseSearch'\n\nconst getParamOr = (param: string | string[] | undefined, fallback: string) =>\n  (Array.isArray(param) ? param[0] : param) || fallback\n\nconst EVENT_SOURCE = 'quilt-embed'\nconst search = parseSearch(window.location.search)\nconst NONCE = getParamOr(search.nonce, `${Math.random}`)\nconst PARENT_ORIGIN = getParamOr(search.origin, '*')\n\nexport function useMessageParent() {\n  return React.useCallback((data: object) => {\n    window.parent.postMessage(\n      { source: EVENT_SOURCE, nonce: NONCE, ...data },\n      PARENT_ORIGIN,\n    )\n  }, [])\n}\n\nexport function useMessageHandler(fn: (data: object) => void) {\n  const handleMessage = React.useCallback(\n    (e: MessageEvent) => {\n      if (\n        e.source !== window.parent ||\n        (PARENT_ORIGIN !== '*' && e.origin !== PARENT_ORIGIN) ||\n        !e.data?.type\n      )\n        return\n      fn(e.data)\n    },\n    [fn],\n  )\n\n  React.useEffect(() => {\n    window.addEventListener('message', handleMessage)\n    return () => {\n      window.removeEventListener('message', handleMessage)\n    }\n  }, [handleMessage])\n}\n","import * as React from 'react'\n\nconst Ctx = React.createContext({})\n\nfunction EmbedConfigProvider({ config, children }) {\n  return <Ctx.Provider value={config}>{children}</Ctx.Provider>\n}\n\nfunction useEmbedConfig() {\n  return React.useContext(Ctx)\n}\n\nexport { EmbedConfigProvider as Provider, useEmbedConfig as use }\n","import { mkSearch } from 'utils/NamedRoutes'\nimport { encode } from 'utils/s3paths'\n\nexport const bucketRoot = {\n  path: '/b/:bucket',\n  url: (bucket) => `/b/${bucket}`,\n}\nexport const bucketFile = {\n  path: '/b/:bucket/tree/:path(.*[^/])',\n  url: (bucket, path, version) =>\n    `/b/${bucket}/tree/${encode(path)}${mkSearch({ version })}`,\n}\nexport const bucketDir = {\n  path: '/b/:bucket/tree/:path(.+/)?',\n  url: (bucket, path = '', prefix) =>\n    `/b/${bucket}/tree/${encode(path)}${mkSearch({ prefix: prefix || undefined })}`,\n}\nexport const bucketSearch = {\n  path: '/b/:bucket/search',\n  url: (bucket, { q, p, retry }) => `/b/${bucket}/search${mkSearch({ q, p, retry })}`,\n}\n","import { basename } from 'path'\n\nimport * as React from 'react'\nimport { useHistory, useRouteMatch, Link } from 'react-router-dom'\nimport * as M from '@material-ui/core'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\n\nimport * as NamedRoutes from 'utils/NamedRoutes'\nimport parse from 'utils/parseSearch'\nimport { useRoute } from 'utils/router'\n\nimport * as EmbedConfig from './EmbedConfig'\n\nconst useSearchBoxStyles = M.makeStyles((t) => ({\n  root: {\n    background: fade(t.palette.common.white, 0.1),\n    borderRadius: t.shape.borderRadius,\n    color: t.palette.common.white,\n    overflow: 'hidden',\n    position: 'absolute',\n    right: 0,\n    transition: ['background-color 200ms', 'width 200ms'],\n    width: t.spacing(24),\n    '&:hover': {\n      background: fade(t.palette.common.white, 0.2),\n    },\n  },\n  focused: {\n    background: `${fade(t.palette.common.white, 0.2)} !important`,\n    width: '100%',\n  },\n  input: {\n    paddingLeft: t.spacing(4),\n    paddingTop: 8,\n    paddingBottom: 9,\n    textOverflow: 'ellipsis',\n  },\n  adornment: {\n    cursor: 'pointer',\n    justifyContent: 'center',\n    pointerEvents: 'none',\n    position: 'absolute',\n    width: t.spacing(4),\n  },\n}))\n\nfunction SearchBox({ bucket }) {\n  const history = useHistory()\n  const { paths, urls } = NamedRoutes.use()\n\n  const { location: l, match } = useRoute(paths.bucketSearch)\n  const query = (match && parse(l.search).q) || ''\n\n  const makeUrl = React.useCallback(\n    (q) => urls.bucketSearch(bucket, { q }),\n    [urls, bucket],\n  )\n\n  const [value, change] = React.useState(null)\n  const [focused, setFocused] = React.useState(false)\n\n  const handleChange = React.useCallback(\n    (evt) => {\n      change(evt.target.value)\n    },\n    [change],\n  )\n\n  const handleKeyDown = React.useCallback(\n    (evt) => {\n      // eslint-disable-next-line default-case\n      switch (evt.key) {\n        case 'Enter':\n          if (query !== value) {\n            history.push(makeUrl(value))\n          }\n          evt.target.blur()\n          break\n        case 'Escape':\n          evt.target.blur()\n          break\n      }\n    },\n    [history, makeUrl, value, query],\n  )\n\n  const handleFocus = React.useCallback(() => {\n    change(query)\n    setFocused(true)\n  }, [query, change, setFocused])\n\n  const handleBlur = React.useCallback(() => {\n    change(null)\n    setFocused(false)\n  }, [change, setFocused])\n\n  const { adornment, ...classes } = useSearchBoxStyles()\n\n  return (\n    <M.InputBase\n      value={value === null ? query : value}\n      startAdornment={\n        <M.InputAdornment className={adornment}>\n          <M.Icon>search</M.Icon>\n        </M.InputAdornment>\n      }\n      classes={classes}\n      placeholder={focused ? `Search s3://${bucket}` : 'Search'}\n      onChange={handleChange}\n      onFocus={handleFocus}\n      onBlur={handleBlur}\n      onKeyDown={handleKeyDown}\n    />\n  )\n}\n\nconst useStyles = M.makeStyles((t) => ({\n  appBar: {\n    zIndex: t.zIndex.appBar + 1,\n  },\n  btn: {\n    color: t.palette.common.white,\n    backgroundColor: fade(t.palette.common.white, 0.1),\n    '&:hover': {\n      backgroundColor: fade(t.palette.common.white, 0.2),\n      // Reset on touch devices, it doesn't add specificity\n      '@media (hover: none)': {\n        backgroundColor: fade(t.palette.common.white, 0.1),\n      },\n    },\n  },\n}))\n\nexport default function AppBar({ bucket }) {\n  const cfg = EmbedConfig.use()\n  const trigger = M.useScrollTrigger()\n  const classes = useStyles()\n  const { urls, paths } = NamedRoutes.use()\n  const isSearch = !!useRouteMatch(paths.bucketSearch)\n  const rootUrl = urls.bucketDir(bucket, cfg.scope)\n  const showRootLink = !cfg.hideRootLink || isSearch\n  return (\n    <>\n      <M.Toolbar />\n      <M.Slide appear={false} direction=\"down\" in={!trigger}>\n        <M.AppBar className={classes.appBar}>\n          <M.Toolbar disableGutters>\n            <M.Container maxWidth=\"lg\" style={{ display: 'flex' }}>\n              {showRootLink && (\n                <M.Button\n                  to={rootUrl}\n                  component={Link}\n                  variant=\"contained\"\n                  className={classes.btn}\n                >\n                  {cfg.hideRootLink && isSearch ? ( // eslint-disable-line no-nested-ternary\n                    <>\n                      <M.Icon style={{ fontSize: 16, marginLeft: -2 }}>\n                        arrow_back_ios\n                      </M.Icon>{' '}\n                      Back\n                    </>\n                  ) : cfg.scope ? (\n                    basename(cfg.scope)\n                  ) : (\n                    `s3://${bucket}`\n                  )}\n                </M.Button>\n              )}\n              <M.Box\n                display=\"flex\"\n                alignItems=\"center\"\n                position=\"relative\"\n                flexGrow={1}\n                ml={showRootLink ? 2 : undefined}\n              >\n                <SearchBox bucket={bucket} />\n              </M.Box>\n            </M.Container>\n          </M.Toolbar>\n        </M.AppBar>\n      </M.Slide>\n    </>\n  )\n}\n","// side-effect: inject global css\nimport 'sanitize.css'\n\nimport * as R from 'ramda'\nimport * as React from 'react'\nimport * as redux from 'react-redux'\nimport { Route, Switch, useLocation } from 'react-router-dom'\nimport { createMemoryHistory as createHistory } from 'history'\nimport * as M from '@material-ui/core'\n\nimport * as Layout from 'components/Layout'\nimport Placeholder from 'components/Placeholder'\nimport * as Auth from 'containers/Auth'\nimport { ThrowNotFound, createNotFound } from 'containers/NotFoundPage'\nimport * as Notifications from 'containers/Notifications'\nimport * as routes from 'constants/embed-routes'\nimport * as style from 'constants/style'\nimport * as APIConnector from 'utils/APIConnector'\nimport * as AWS from 'utils/AWS'\nimport * as BucketCache from 'utils/BucketCache'\nimport * as Config from 'utils/Config'\nimport { createBoundary } from 'utils/ErrorBoundary'\nimport { GraphQLProvider } from 'utils/GraphQL'\nimport * as NamedRoutes from 'utils/NamedRoutes'\nimport * as Cache from 'utils/ResourceCache'\nimport * as Sentry from 'utils/Sentry'\nimport * as Store from 'utils/Store'\nimport defer from 'utils/defer'\nimport { ErrorDisplay } from 'utils/error'\nimport * as RT from 'utils/reactTools'\nimport RouterProvider from 'utils/router'\nimport * as s3paths from 'utils/s3paths'\nimport useConstant from 'utils/useConstant'\nimport useMemoEq from 'utils/useMemoEq'\nimport usePrevious from 'utils/usePrevious'\n\n// TODO: consider reimplementing these locally or moving to some shared location\nimport { displayError } from 'containers/Bucket/errors'\n\nimport WithGlobalStyles from '../global-styles'\n\nimport AppBar from './AppBar'\nimport * as EmbedConfig from './EmbedConfig'\nimport * as Overrides from './Overrides'\nimport * as ipc from './ipc'\n\nconst SuspensePlaceholder = () => <Placeholder color=\"text.secondary\" />\n\nconst Dir = RT.mkLazy(() => import('./Dir'), SuspensePlaceholder)\nconst File = RT.mkLazy(() => import('./File'), SuspensePlaceholder)\nconst Search = RT.mkLazy(() => import('./Search'), SuspensePlaceholder)\n\nconst FinalBoundary = createBoundary(() => (error) => (\n  <h1\n    style={{\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      height: 400,\n      maxHeight: '90vh',\n      fontFamily: 'sans-serif',\n      margin: 0,\n    }}\n  >\n    {error.headline || 'Something went wrong'}\n  </h1>\n))\n\nfunction StyledError({ children }) {\n  return (\n    <M.Box\n      display=\"flex\"\n      alignItems=\"center\"\n      justifyContent=\"center\"\n      height={400}\n      maxHeight=\"90vh\"\n      textAlign=\"center\"\n    >\n      <M.Typography variant=\"h3\">{children}</M.Typography>\n    </M.Box>\n  )\n}\n\nconst ErrorBoundary = createBoundary(() => (error) => (\n  <StyledError>{error.headline || 'Something went wrong'}</StyledError>\n))\n\nconst CatchNotFound = createNotFound(() => <StyledError>Page not found</StyledError>)\n\nfunction Root() {\n  const l = useLocation()\n  const { paths } = NamedRoutes.use()\n  return (\n    <CatchNotFound id={`${l.pathname}${l.search}${l.hash}`}>\n      <Switch>\n        <Route path={paths.bucketRoot} component={Bucket} />\n        <Route component={ThrowNotFound} />\n      </Switch>\n    </CatchNotFound>\n  )\n}\n\nfunction Bucket({\n  match: {\n    params: { bucket },\n  },\n}) {\n  const { paths } = NamedRoutes.use()\n\n  return (\n    <BucketLayout bucket={bucket}>\n      <Switch>\n        <Route path={paths.bucketFile} component={File} exact strict />\n        <Route path={paths.bucketDir} component={Dir} exact />\n        <Route path={paths.bucketSearch} component={Search} exact />\n        <Route component={ThrowNotFound} />\n      </Switch>\n    </BucketLayout>\n  )\n}\n\nfunction BucketLayout({ bucket, children }) {\n  const data = BucketCache.useBucketExistence(bucket)\n  return (\n    <>\n      <AppBar bucket={bucket} />\n      <M.Container maxWidth=\"lg\">\n        {data.case({\n          Ok: () => children,\n          Err: displayError(),\n          _: () => <Placeholder color=\"text.secondary\" />,\n        })}\n      </M.Container>\n      <M.Box flexGrow={1} />\n    </>\n  )\n}\n\nfunction useInit() {\n  const messageParent = ipc.useMessageParent()\n  const [state, setState] = React.useState(null)\n\n  ipc.useMessageHandler(\n    React.useCallback(\n      ({ type, ...init }) => {\n        if (type !== 'init') return\n        try {\n          if (!init.bucket && !init.route)\n            throw new Error('missing either .bucket or .route')\n          if (init.scope) {\n            if (typeof init.scope !== 'string') throw new Error('.scope must be a string')\n            // eslint-disable-next-line no-param-reassign\n            init.scope = s3paths.ensureSlash(init.scope)\n          }\n          Overrides.validate(init.overrides)\n          setState(init)\n        } catch (e) {\n          const message = `Configuration error: ${e.message}`\n          // eslint-disable-next-line no-console\n          console.error(message)\n          // eslint-disable-next-line no-console\n          console.log('init object:', init)\n          messageParent({ type: 'error', message, init })\n          setState(e)\n        }\n      },\n      [setState, messageParent],\n    ),\n  )\n\n  React.useEffect(() => {\n    messageParent({ type: 'ready' })\n  }, [messageParent])\n\n  return state\n}\n\nfunction Init() {\n  const [key, setKey] = React.useState(0)\n  const init = useInit()\n  usePrevious(init, (prev) => {\n    if (init !== prev) {\n      setKey((k) => k + 1)\n    }\n  })\n  if (!init) return <Placeholder color=\"text.secondary\" />\n  if (init instanceof Error) {\n    return <StyledError>Configuration error</StyledError>\n  }\n  return (\n    <ErrorBoundary key={key}>\n      <App {...{ key, init }} />\n    </ErrorBoundary>\n  )\n}\n\nfunction usePostInit(init) {\n  const dispatch = redux.useDispatch()\n  const messageParent = ipc.useMessageParent()\n  const [state, setState] = React.useState(null)\n\n  React.useEffect(() => {\n    const result = defer()\n    dispatch(Auth.actions.signIn(init.credentials, result.resolver))\n    result.promise\n      .then(() => {\n        setState(true)\n        messageParent({ type: 'init', init })\n      })\n      .catch((e) => {\n        // eslint-disable-next-line no-console\n        console.warn('Authentication failure:')\n        // eslint-disable-next-line no-console\n        console.error(e)\n        setState(new ErrorDisplay('Authentication Failure'))\n        messageParent({\n          type: 'error',\n          message: `Authentication failure: ${e.message}`,\n          credentials: init.credentials,\n        })\n      })\n  }, [init, dispatch, messageParent])\n\n  return state\n}\n\nfunction PostInit({ init, children }) {\n  const state = usePostInit(init)\n  if (!state) return <Placeholder color=\"text.secondary\" />\n  if (state instanceof Error) throw state\n  return children\n}\n\nfunction WithCustomTheme({ theme, children }) {\n  const customTheme = useMemoEq(theme, style.createCustomAppTheme)\n  return (\n    <M.MuiThemeProvider theme={customTheme}>\n      <WithGlobalStyles>{children}</WithGlobalStyles>\n    </M.MuiThemeProvider>\n  )\n}\n\nfunction CustomThemeProvider({ theme, children }) {\n  if (!theme || R.isEmpty(theme)) return children\n  return <WithCustomTheme theme={theme}>{children}</WithCustomTheme>\n}\n\nconst appendLink = (el) => {\n  const x = window.document.getElementsByTagName('link')[0]\n  x.parentNode.insertBefore(el, x)\n}\n\nconst removeLink = (el) => {\n  el.parentNode.removeChild(el)\n}\n\nfunction useCssFiles(files = []) {\n  React.useEffect(() => {\n    const els = files.map((href) => {\n      const el = window.document.createElement('link')\n      el.rel = 'stylesheet'\n      el.href = href\n      appendLink(el)\n      return el\n    })\n\n    return () => {\n      els.forEach(removeLink)\n    }\n  }, [files])\n}\n\nfunction useSyncHistory(history) {\n  const messageParent = ipc.useMessageParent()\n\n  ipc.useMessageHandler(\n    React.useCallback(\n      ({ type, ...data }) => {\n        if (type !== 'navigate') return\n        try {\n          if (!data.route) throw new Error('missing .route')\n          if (typeof data.route !== 'string') throw new Error('.route must be a string')\n          history.push(data.route)\n        } catch (e) {\n          const message = `Navigate: error: ${e.message}`\n          // eslint-disable-next-line no-console\n          console.error(message)\n          // eslint-disable-next-line no-console\n          console.log('params:', data)\n          messageParent({ type: 'error', message, data })\n        }\n      },\n      [history, messageParent],\n    ),\n  )\n\n  React.useEffect(\n    () =>\n      history.listen((l, action) => {\n        messageParent({\n          type: 'navigate',\n          route: `${l.pathname}${l.search}${l.hash}`,\n          action,\n        })\n      }),\n    [history, messageParent],\n  )\n}\n\nfunction App({ init }) {\n  const { urls } = NamedRoutes.use()\n  const history = useConstant(() =>\n    createHistory({\n      initialEntries: [init.route || urls.bucketDir(init.bucket, init.path)],\n    }),\n  )\n\n  useSyncHistory(history)\n\n  const storage = useConstant(() => ({\n    load: () => ({}),\n    set: () => {},\n    remove: () => {},\n  }))\n\n  useCssFiles(init.css)\n\n  return RT.nest(\n    [Overrides.Provider, { value: init.overrides }],\n    [EmbedConfig.Provider, { config: init }],\n    [CustomThemeProvider, { theme: init.theme }],\n    [Store.Provider, { history }],\n    [RouterProvider, { history }],\n    Cache.Provider,\n    [Config.Provider, { path: '/config.json' }],\n    [React.Suspense, { fallback: <Placeholder color=\"text.secondary\" /> }],\n    GraphQLProvider,\n    Notifications.Provider,\n    [APIConnector.Provider, { fetch, middleware: [Auth.apiMiddleware] }],\n    [Auth.Provider, { storage }],\n    AWS.Credentials.Provider,\n    AWS.Config.Provider,\n    AWS.S3.Provider,\n    Notifications.WithNotifications,\n    BucketCache.Provider,\n    [PostInit, { init }],\n    Root,\n  )\n}\n\nexport default function Embed() {\n  return RT.nest(\n    FinalBoundary,\n    [M.MuiThemeProvider, { theme: style.appTheme }],\n    WithGlobalStyles,\n    Layout.Root,\n    ErrorBoundary,\n    Sentry.Provider,\n    [NamedRoutes.Provider, { routes }],\n    [Init],\n  )\n}\n","/* embed/index.js - embedded browser entry point */\nimport * as React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport Embed from './Embed'\n\nReactDOM.render(<Embed />, document.getElementById('app'))\n"],"names":["Context","displayName","Provider","merge","l","r","useOverrides","defaults","overrides","compile","assertIsObject","scope","obj","Error","compileTemplate","str","e","message","validateEmit","v","s3ObjectLink","href","emit","validate","input","getParamOr","param","fallback","Array","isArray","search","window","location","NONCE","nonce","Math","random","PARENT_ORIGIN","origin","useMessageParent","data","parent","postMessage","source","useMessageHandler","fn","handleMessage","type","addEventListener","removeEventListener","Ctx","EmbedConfigProvider","config","children","value","useEmbedConfig","bucketRoot","path","url","bucket","bucketFile","version","bucketDir","prefix","undefined","bucketSearch","q","p","retry","useSearchBoxStyles","t","root","background","palette","common","white","borderRadius","shape","color","overflow","position","right","transition","width","spacing","focused","paddingLeft","paddingTop","paddingBottom","textOverflow","adornment","cursor","justifyContent","pointerEvents","SearchBox","history","NamedRoutes","paths","urls","query","makeUrl","change","setFocused","handleChange","evt","target","handleKeyDown","key","push","blur","handleFocus","handleBlur","classes","startAdornment","className","placeholder","onChange","onFocus","onBlur","onKeyDown","useStyles","appBar","zIndex","btn","backgroundColor","cfg","EmbedConfig","trigger","isSearch","rootUrl","showRootLink","hideRootLink","appear","direction","in","disableGutters","maxWidth","style","display","to","component","Link","variant","fontSize","marginLeft","basename","alignItems","flexGrow","ml","SuspensePlaceholder","Placeholder","Dir","File","Search","FinalBoundary","error","height","maxHeight","fontFamily","margin","headline","StyledError","textAlign","CatchNotFound","Root","id","pathname","hash","Bucket","BucketLayout","exact","strict","BucketCache","case","Ok","Err","_","Init","setKey","init","messageParent","ipc","state","setState","route","s3paths","Overrides","console","log","useInit","usePrevious","prev","k","App","PostInit","dispatch","result","defer","Auth","credentials","resolver","promise","then","catch","warn","usePostInit","WithCustomTheme","theme","customTheme","useMemoEq","CustomThemeProvider","removeLink","el","parentNode","removeChild","useCssFiles","files","els","map","document","createElement","rel","x","getElementsByTagName","insertBefore","appendLink","forEach","useConstant","initialEntries","listen","action","useSyncHistory","storage","load","set","remove","css","Store","Config","GraphQL","Notifications","APIConnector","fetch","middleware","AWS","S3","Layout","Sentry","routes","getElementById"],"sourceRoot":""}