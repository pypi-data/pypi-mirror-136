"use strict";(self.webpackChunkquilt_navigator=self.webpackChunkquilt_navigator||[]).push([[490],{60490:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ce});var r=n(70655),a=n(26470),l=n(66518),c=n.n(l),i=n(919),o=n(36962),s=n(82539),u=n(30601),m=n(67294),f=n(5977),d=n(41120),p=n(10529),h=n(95477),k=n(78869),b=n(43987),E=n(80679),g=n(766),v=n(84268),w=n(57156),Z=n(69534),C=n(99199),y=n(82268),x=n(36473),S=n(15592),N=n(64890),F=n(33125),_=n(25170),q=n(95142),D=n(16946),W=n(13646),P=n(66688),M=n(66083),$=n(29525),B=n(66856),I=n(92863),O=n(22318),T=n(282),z=n(84170),R=n(89007),G=n(70397),J=n(31708),A=n(79512),L=n(45677),V=function(e,t){var n=e.filter(D.Z("selected",!0));return n.length===e.length?[{logical_key:".",path:t,is_dir:!0}]:n.map((function(e){var n=e.type,r=e.name;return{logical_key:r,path:t+r,is_dir:"dir"===n}}))};function Y(e){var t=e.bucket,n=e.path,r=Z.D$().urls,a=n?'"'+n+'"':"root";return m.createElement(m.Fragment,null,"Push ",a," directory to"," ",m.createElement(G.Z,{target:"_blank",to:r.bucketOverview(t)},t)," ","bucket as package")}var H=d.Z((function(e){return{files:{height:"100%"},form:{height:"100%"},meta:{display:"flex",flexDirection:"column",paddingTop:e.spacing(3),overflowY:"auto"}}}));function j(e){var t=this,n=e.bucket,l=e.path,c=e.truncated,i=e.dirs,o=e.files,s=e.close,u=e.responseError,f=e.schema,d=e.schemaLoading,h=e.selectedWorkflow,k=e.setSubmitting,b=e.setSuccess,E=e.setWorkflow,g=e.successor,v=e.validate,w=e.workflowsConfig,Z=A.Wk(h),C=A.OW(g.slug),y=m.useState(""),x=y[0],S=y[1],N=m.useState(0),F=N[0],_=N[1],D=A.qi(w),z=H(),R=L.F(),G=A.cD({metaHeight:F}),j=m.useCallback((function(e){return(0,r.mG)(t,void 0,void 0,(function(){var t,a,c,i,o=e.commitMessage,s=e.files,u=(0,r._T)(e,["commitMessage","files"]);return(0,r.Jh)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,R((0,r.pi)((0,r.pi)({},u),{entries:V(s,l),message:o,source:n,target:{bucket:g.slug,name:u.name}}),f)];case 1:return t=e.sent(),b({name:u.name,hash:t.top_hash}),[3,3];case 2:return a=e.sent(),console.log("error creating manifest",a),c=a instanceof Error?a.message:null,[2,(i={},i[q.Ck]=c||A.RZ.MANIFEST,i)];case 3:return[2]}}))}))}),[n,g,R,b,f,l]),K=m.useMemo((function(){return(0,r.ev)((0,r.ev)([],i.map((function(e){return{type:"dir",name:(0,a.basename)(e),selected:!1}})),!0),o.map((function(e){return{type:"file",name:(0,a.basename)(e.key),size:e.size,selected:!1}})),!0)}),[i,o]),U=m.useCallback((function(e){return(0,r.mG)(t,void 0,void 0,(function(){var t,n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return[4,C.validate(e)];case 1:return t=r.sent(),(n=m.createElement(A.Nt,{exists:!!t}))!==x&&S(n),[2]}}))}))}),[x,C]),Q=m.useState(null),X=Q[0],ee=Q[1],te=m.useMemo((function(){return new window.ResizeObserver((function(e){var t=e[0].contentRect.height;_(t)}))}),[_]),ne=m.useCallback((function(e){var n=e.values;return(0,r.mG)(t,void 0,void 0,(function(){return(0,r.Jh)(this,(function(e){return U(n.name),[2]}))}))}),[U]);m.useEffect((function(){return X&&te.observe(X),function(){X&&te.unobserve(X)}}),[X,te]);var re=m.useState(!1),ae=re[0],le=re[1];return m.createElement(P.l0,{onSubmit:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return(0,r.mG)(t,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:k(!0),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,j.apply(void 0,e)];case 2:return[2,t.sent()];case 3:return k(!1),[7];case 4:return[2]}}))}))},subscription:{submitting:!0,submitFailed:!0,error:!0,submitError:!0,hasValidationErrors:!0}},(function(e){var t,n=e.handleSubmit,r=e.submitting,a=e.submitFailed,i=e.error,o=e.submitError,k=e.hasValidationErrors;return m.createElement(m.Fragment,null,m.createElement(M.Z,null,m.createElement(Y,{bucket:g.slug,path:l})),m.createElement($.Z,{classes:G},m.createElement("form",{onSubmit:n,className:z.form},m.createElement(P.lP,{subscription:{dirtyFields:!0,values:!0},onChange:ne}),m.createElement(P.lP,{subscription:{modified:!0,values:!0},onChange:function(e){var t=e.modified,n=e.values;(null==t?void 0:t.workflow)&&n.workflow!==h&&(E(n.workflow),le(!0),setTimeout((function(){le(!1)}),300))}}),m.createElement(A.W2,null,m.createElement(A.ER,null,m.createElement(P.gN,{component:A.Wr,name:"workflow",workflowsConfig:w,initialValue:h,validate:D,validateFields:["meta","workflow"],errors:{required:"Workflow is required for this bucket."}}),m.createElement(P.gN,{component:A.rr,directory:l,workflow:h||w,name:"name",validate:J.ne(J.C1,Z.validate),validateFields:["name"],errors:{required:"Enter a package name",invalid:"Invalid package name",pattern:'Name should match "'+(null==h?void 0:h.packageNamePattern)+'" regexp'},helperText:x}),m.createElement(P.gN,{component:A.WZ,name:"commitMessage",validate:J.C1,validateFields:["commitMessage"],errors:{required:"Enter a commit message"}}),d||ae?m.createElement(A.BA,{className:z.meta,ref:ee}):m.createElement(P.gN,{className:z.meta,component:A.fc,name:"meta",bucket:g.slug,schema:f,schemaError:u,validate:v,validateFields:["meta"],isEqual:W.Z,initialValue:A.kJ,ref:ee})),m.createElement(A.b,null,m.createElement(P.gN,{className:z.files,component:A.zs,name:"files",validate:A.Pm,validateFields:["files"],errors:(t={},t[A.K6]="Select something to create a package",t),title:"Select files and directories to package",isEqual:W.Z,initialValue:K,truncated:c}))),m.createElement("input",{type:"submit",style:{display:"none"}}))),m.createElement(B.Z,null,r&&m.createElement(A.RY,null,g.copyData?"Copying files and writing manifest":"Writing manifest"),!r&&(!!i||!!o)&&m.createElement(p.Z,{flexGrow:1,display:"flex",alignItems:"center",pl:2},m.createElement(I.Z,{color:"error"},"error_outline"),m.createElement(p.Z,{pl:1}),m.createElement(O.Z,{variant:"body2",color:"error"},i||o)),m.createElement(T.Z,{onClick:s,disabled:r},"Cancel"),m.createElement(T.Z,{onClick:n,variant:"contained",color:"primary",disabled:r||a&&k},"Push")))}))}function K(e){var t=e.bucket,n=e.error,r=e.path,a=e.onCancel;return m.createElement(A.Ss,{error:n,skeletonElement:m.createElement(A.PF,{animate:!1}),title:m.createElement(Y,{bucket:t,path:r}),onCancel:a})}function U(e){var t=e.bucket,n=e.path,r=e.onCancel;return m.createElement(A.HI,{skeletonElement:m.createElement(A.PF,null),title:m.createElement(Y,{bucket:t,path:n}),onCancel:r})}function Q(e){var t=e.bucket,n=e.path,a=e.truncated,l=e.dirs,c=e.files,i=e.onClose,o=e.onExited,s=e.open,u=e.successor,f=E.S3.use(),d=m.useState(),p=d[0],h=d[1],k=m.useState(null),b=k[0],g=k[1],w=m.useState(!1),Z=w[0],C=w[1],y=v.D$(L.sq,{s3:f,bucket:u?u.slug:""},{noAutoFetch:!u||!s}),x=m.useCallback((function(){Z||(o({pushed:b}),i&&i(),g(null))}),[Z,b,g,i,o]),S=m.useCallback((function(){Z||(o({pushed:b}),i&&i(),g(null))}),[Z,b,g,i,o]);return R.r3(s),m.createElement(z.Z,{fullWidth:!0,maxWidth:b?"sm":"lg",onClose:x,onExited:S,open:s,scroll:"body"},b&&u?m.createElement(A.wx,{bucket:u.slug,name:b.name,hash:b.hash,onClose:x}):y.case({Err:function(e){return u&&m.createElement(K,{bucket:u.slug,path:n,onCancel:x,error:e})},Ok:function(e){return u&&m.createElement(A.ux,{workflow:p,workflowsConfig:e},(function(i){return m.createElement(j,(0,r.pi)({},i,{bucket:t,path:n,truncated:a,dirs:l,files:c,close:x,setSubmitting:C,setSuccess:g,setWorkflow:h,successor:u,workflowsConfig:e}))}))},_:function(){return u&&m.createElement(U,{bucket:u.slug,path:n,onCancel:x})}}))}var X=n(43141),ee=n(73206),te=i.Z(o.Z(k.$2.Sep(m.createElement(m.Fragment,null,"Â / "))),(function(e){var t=e.bucket,n=e.path,a=e.urls;return(0,r.ev)([{label:t,path:""}],(0,x.tO)(n),!0).map((function(e){var r=e.label,l=e.path;return k.$2.Segment({label:r,to:l===n?void 0:a.bucketDir(t,l)})}))}));function ne(e){var t=e.response,n=e.locked,a=e.bucket,l=e.path,c=e.successor,i=e.setSuccessor,o=e.loadMore,d=f.k6(),p=Z.D$().urls,h=m.useCallback((function(){i(null)}),[i]),k=m.useCallback((function(e){d.push(p.bucketDir(a,l,e))}),[d,p,a,l]),b=function(e){var t=Z.D$().urls;return m.useMemo((function(){var n=e.dirs.map((function(n){return{type:"dir",name:(0,x.ge)((0,x.ro)(e.path,n)),to:t.bucketDir(e.bucket,n)}})),a=e.files.map((function(n){var r=n.key,a=n.size,l=n.modified,c=n.archived;return{type:"file",name:(0,x.ro)(e.path,r),to:t.bucketFile(e.bucket,r),size:a,modified:l,archived:c}})),l=(0,r.ev)((0,r.ev)((0,r.ev)([],""===e.path||e.prefix?[]:[{type:"dir",name:"..",to:t.bucketDir(e.bucket,(0,x.up)(e.path))}],!0),n,!0),a,!0);return s.Z(u.Z("name"),l)}),[e,t])}(t);return m.createElement(m.Fragment,null,m.createElement(Q,{bucket:a,path:l,files:t.files,dirs:t.dirs,truncated:t.truncated,open:!!c,successor:c,onExited:h}),m.createElement(_.NB,{items:b,locked:n,loadMore:o,truncated:t.truncated,prefixFilter:t.prefix,toolbarContents:m.createElement(_.I4,{key:t.bucket+"/"+t.path,prefix:t.prefix,setPrefix:k})}),m.createElement(X.Z,{files:t.files,mkUrl:null}))}var re,ae,le=d.Z((function(e){return{crumbs:(0,r.pi)((0,r.pi)({},e.typography.body1),{maxWidth:"100%",overflowWrap:"break-word"}),button:{flexShrink:0,marginBottom:"-3px",marginLeft:e.spacing(1),marginTop:"-3px"}}}));function ce(e){var t,n,l=e.match.params,i=l.bucket,o=l.path,s=void 0===o?"":o,u=e.location,f=le(),d=Z.D$().urls,_=g.D$().noDownload,q=E.S3.use(),D=C.D$(),W=(0,y.Z)(u.search).prefix,P=(0,x.Jx)(s),M=P?(0,a.basename)(P):i,$=m.useMemo((function(){return[{label:"Python",hl:"python",contents:c()(re||(re=(0,r.cy)(['\n          import quilt3\n          b = quilt3.Bucket("s3://','")\n          # list files\n          b.ls("','")\n          # download\n          b.fetch("','", "./','")\n        '],['\n          import quilt3\n          b = quilt3.Bucket("s3://','")\n          # list files\n          b.ls("','")\n          # download\n          b.fetch("','", "./','")\n        '])),i,P,P,M)},{label:"CLI",hl:"bash",contents:c()(ae||(ae=(0,r.cy)(['\n          # list files\n          aws s3 ls "s3://',"/",'"\n          # download\n          aws s3 cp --recursive "s3://',"/",'" "./','"\n        '],['\n          # list files\n          aws s3 ls "s3://',"/",'"\n          # download\n          aws s3 cp --recursive "s3://',"/",'" "./','"\n        '])),i,P,i,P,M)}]}),[i,P,M]),B=m.useState(null),I=B[0],O=B[1],T=m.useState(null),z=T[0],R=T[1];m.useLayoutEffect((function(){R(null)}),[P,W]);var G=(0,v.et)(L.rx,{s3:q,bucket:i,path:P,prefix:W,prev:z}),J=m.useCallback((function(){b.Z.case({Ok:function(e){e.continuationToken&&R(e)},_:function(){}},G.result)}),[G.result]);return m.createElement(p.Z,{pt:2,pb:4},m.createElement(w.Z,null,[P||"Files",i]),m.createElement(p.Z,{display:"flex",alignItems:"flex-start",mb:2},m.createElement("div",{className:f.crumbs,onCopy:k.Yn},(0,k.sY)(te({bucket:i,path:P,urls:d}))),m.createElement(p.Z,{flexGrow:1}),(null===(n=null===(t=null==D?void 0:D.ui)||void 0===t?void 0:t.actions)||void 0===n?void 0:n.createPackage)&&m.createElement(N.Z,{bucket:i,className:f.button,onChange:O},"Create package from directory"),!_&&m.createElement(F.dN,{className:f.button,suffix:"dir/"+i+"/"+P,label:"Download directory"})),m.createElement(S.Z,{gutterBottom:!0},$),G.case({Err:(0,ee.Sj)(),Init:function(){return null},_:function(e){var t=b.Z.getPrevResult(e);return t?m.createElement(ne,{response:t,locked:!b.Z.Ok.is(e),bucket:i,path:P,successor:I,setSuccessor:O,loadMore:J}):m.createElement(h.Z,null)}}))}},64890:(e,t,n)=>{n.d(t,{Z:()=>N});var r=n(70655),a=n(10180),l=n(67294),c=n(8920),i=n(10529),o=n(85639),s=n(95757),u=n(38396),m=n(22318),f=n(63457),d=n(17812),p=n(92863),h=n(282),k=n(58365),b=n(80679),E=n(84268),g=n(70397),v=n(10327),w=n(73206),Z=n(45677);function C(){var e=c.Z();return l.createElement(i.Z,{minWidth:e.spacing(22)},l.createElement(o.Z,{disabled:!0},l.createElement(k.Z,{height:e.spacing(6),width:"100%"})),l.createElement(o.Z,{disabled:!0},l.createElement(k.Z,{height:e.spacing(6),width:"100%"})),l.createElement(o.Z,{disabled:!0},l.createElement(k.Z,{height:e.spacing(6),width:"100%"})))}var y=l.forwardRef((function(e,t){var n=e.item,r=e.onClick;return l.createElement(o.Z,{ref:t,onClick:l.useCallback((function(){return r(n)}),[n,r])},l.createElement(s.Z,{primary:n.name,secondary:n.url}))}));function x(e){var t=e.anchorEl,n=e.bucket,r=e.open,c=e.onChange,o=e.onClose,s=b.S3.use(),f=(0,E.et)(Z.sq,{s3:s,bucket:n});return l.createElement(u.Z,{anchorEl:t,onClose:o,open:r},f.case({Ok:function(e){var t=e.successors;return t.length?t.map((function(e){return l.createElement(y,{key:e.slug,item:e,onClick:c})})):l.createElement(i.Z,{px:2,py:1},l.createElement(m.Z,{gutterBottom:!0},"Add or update a config.yml file to populate this menu."),l.createElement(m.Z,null,l.createElement(g.Z,{href:v.rx+"/advanced-usage/workflows#pushing-across-buckets-with-the-quilt-catalog",target:"_blank"},"Learn more"),"."))},_:function(){return l.createElement(C,null)},Err:function(e){return l.createElement(i.Z,{px:2,py:1},l.createElement(m.Z,{gutterBottom:!0},"Error: ",l.createElement("code",null,e.message)),a.Z(w.rA,e)&&l.createElement(m.Z,null,"Please fix the workflows config according to"," ",l.createElement(g.Z,{href:v.rx+"/advanced-usage/workflows",target:"_blank"},"the documentation")))}}))}function S(e){var t=e.children,n=e.className,a=e.onClick,i=c.Z(),o={"aria-haspopup":"true",className:n,onClick:a,size:"small"};return f.Z(i.breakpoints.down("sm"))?l.createElement(d.Z,(0,r.pi)({edge:"end",title:t},o),l.createElement(p.Z,null,"exit_to_app")):l.createElement(h.Z,(0,r.pi)({variant:"outlined"},o),t)}function N(e){var t=e.bucket,n=e.className,r=e.children,a=e.onChange,c=l.useState(null),i=c[0],o=c[1],s=l.useCallback((function(e){return o(e.currentTarget)}),[o]),u=l.useCallback((function(e){a(e),o(null)}),[a,o]),m=l.useCallback((function(){return o(null)}),[o]);return l.createElement(l.Fragment,null,l.createElement(S,{className:n,onClick:s},r),l.createElement(x,{anchorEl:i,bucket:t,open:!!i,onChange:u,onClose:m}))}}}]);
//# sourceMappingURL=490.8230fa98ee0eccac9c60.chunk.js.map