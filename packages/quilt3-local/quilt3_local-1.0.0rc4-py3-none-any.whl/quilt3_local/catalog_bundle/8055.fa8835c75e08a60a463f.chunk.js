"use strict";(self.webpackChunkquilt_navigator=self.webpackChunkquilt_navigator||[]).push([[8055],{21587:(e,n,t)=>{t.d(n,{gN:()=>s,XZ:()=>d,Xq:()=>v});var a=t(70655),r=t(67294),i=t(39803),l=t(41120),o=t(30553),c=t(13258),u=t(22318);function s(e){var n=e.input,t=e.meta,l=e.errors,o=e.helperText,c=e.InputLabelProps,u=(0,a._T)(e,["input","meta","errors","helperText","InputLabelProps"]),s=t.submitFailed&&(t.error||t.submitError),m=(0,a.pi)((0,a.pi)({error:!!s,helperText:s?l[s]||s:o,disabled:t.submitting||t.submitSucceeded,InputLabelProps:(0,a.pi)({shrink:!0},c)},n),u);return r.createElement(i.Z,(0,a.pi)({},m))}var m=l.Z({root:{marginBottom:-9,marginTop:-9}});function d(e){var n=e.input,t=void 0===n?{}:n,i=e.meta,l=(e.errors,e.label),u=void 0===l?void 0:l,s=e.FormControlLabelProps,d=void 0===s?{}:s,p=(0,a._T)(e,["input","meta","errors","label","FormControlLabelProps"]),v=m();return r.createElement(o.Z,(0,a.pi)({},d,{control:r.createElement(c.Z,(0,a.pi)({classes:v,disabled:i.submitting||i.submitSucceeded},t,p)),label:u}))}var p=l.Z((function(e){return{root:{marginTop:e.spacing(3),"& a":{textDecoration:"underline"}}}}));function v(e){var n=e.error,t=e.errors,i=(0,a._T)(e,["error","errors"]),l=p();return n?r.createElement(u.Z,(0,a.pi)({color:"error",classes:l},i),t[n]||n):null}},56858:(e,n,t)=>{t.d(n,{F$:()=>c,tL:()=>u,uU:()=>a,GN:()=>s});var a={};t.r(a),t.d(a,{F:()=>r,w:()=>i});var r,i,l=t(32521),o=t(14194);!function(e){e.READ="READ",e.READ_WRITE="READ_WRITE"}(r||(r={})),function(e){e.NAME="NAME",e.MODIFIED="MODIFIED"}(i||(i={}));var c=o.Km(r,"BucketPermissionLevel"),u=["None","Read","ReadWrite"],s=new l.Type("NullableBucketPermissionLevelFromString",(function(e){return null===e||c.is(e)}),(function(e,n){return"None"===e?l.success(null):"Read"===e?l.success(r.READ):"ReadWrite"===e?l.success(r.READ_WRITE):l.failure(e,n)}),(function(e){return e===r.READ?"Read":e===r.READ_WRITE?"ReadWrite":"None"}))},57156:(e,n,t)=>{t.d(n,{Z:()=>o});var a=t(70655),r=t(67294),i=t(64593);function l(e,n){return function(e,n){return n?Array.isArray(n)?(0,a.ev)((0,a.ev)([],n,!0),[e],!1):[n,e]:[e]}(e,n).join(" â€¢ ")}function o(e){var n=e.children,t=e.base,a=void 0===t?"Quilt is a versioned data hub for AWS":t;return r.createElement(i.q,null,r.createElement("title",null,l(a,n)))}},23915:(e,n,t)=>{function a(e){throw new Error("Unexpected value '"+e+"'. Should have been never.")}t.d(n,{Z:()=>a})},98763:(e,n,t)=>{t.d(n,{Ig:()=>o,CN:()=>c});var a=t(67294),r=36e5,i=24*r,l=new Intl.RelativeTimeFormat("en",{numeric:"auto"});function o(e){var n=e.value,t=a.useState(new Date),o=t[0],c=t[1];return a.useEffect((function(){var e=window.setInterval((function(){return c(new Date)}),1e3);return function(){return clearInterval(e)}}),[n]),a.useMemo((function(){return a.createElement(a.Fragment,null,function(e,n){var t=e.valueOf()-((null==n?void 0:n.valueOf())||Date.now()),a=t/31536e6;if(Math.abs(a)>=1)return l.format(Math.round(a),"year");var o=t/2592e6;if(Math.abs(o)>=1)return l.format(Math.round(o),"month");var c=t/i;if(Math.abs(c)>=1)return l.format(Math.round(c),"day");var u=t/r;if(Math.abs(u)>=1)return l.format(Math.round(u),"hour");var s=t/6e4;return Math.abs(s)>=1?l.format(Math.round(s),"minute"):l.format(Math.round(t/1e3),"second")}(n,o))}),[n,o])}function c(e){var n=e.value,t=e.zero,r=e.one,i=e.other;return a.useMemo((function(){return a.createElement(a.Fragment,null,function(e,n){var t=n[function(e){switch(e){case 0:return"zero";case 1:return"one";default:return"other"}}(e)];return t?"function"==typeof t?t(e):t:"function"==typeof n.other?n.other(e):n.other}(n,{zero:t,one:r,other:i}))}),[n,t,r,i])}},14194:(e,n,t)=>{t.d(n,{jV:()=>s.jV,Dw:()=>s.Dw,CM:()=>s.CM,ij:()=>s.ij,Xh:()=>s.Xh,Jx:()=>d,AG:()=>p,Km:()=>f});var a,r=t(70655),i=t(80070),l=t(32521),o=t(84144),c=t(19344),u=t(36155),s=t(96882),m=function(e){function n(n){var t=(0,o.formatValidationErrors)(n).join("\n");return e.call(this,"ValidationError\n"+t)||this}return(0,r.ZT)(n,e),n}(u.G),d=function(e){return c.Z(e.decode,i.g_((function(e){throw new m(e)}),(function(e){return e})))},p=function(e,n){return void 0===n&&(n="Nullable<"+e.name+">"),new l.Type(n,(function(n){return null===n||e.is(n)}),(function(n,t){return null==n?l.success(null):e.validate(n,t)}),(function(e){return e}))};a||(a={});var v=function(e){function n(n,t){var a=e.call(this,t,(function(e){return!!a.enumValues.has(e)&&"number"!=typeof a.enum[e]}),(function(e,n){return a.is(e)?l.success(e):l.failure(e,n)}),l.identity)||this;return a._tag="EnumType",a.enum=n,a.enumValues=new Set(Object.values(n)),a}return(0,r.ZT)(n,e),n}(l.Type),f=function(e,n){return void 0===n&&(n="enum"),new v(e,n)}},22966:(e,n,t)=>{t.d(n,{ZX:()=>m,D$:()=>Z});var a=t(70655),r=t(67294),i=t(41120),l=t(17812),o=t(92863),c=t(10529),u=i.Z((function(e){return{root:{padding:e.spacing(.5)}}}));function s(e){var n=e.direction,t=(0,a._T)(e,["direction"]),i=u();return r.createElement(l.Z,(0,a.pi)({className:i.root},t),r.createElement(o.Z,null,"chevron_"+n))}function m(e){var n=e.page,t=e.pages,a=e.nextPage,i=e.prevPage;return t<=1?null:r.createElement(c.Z,{display:"flex",alignItems:"center"},r.createElement(s,{direction:"left",onClick:i,disabled:n<=1}),r.createElement(s,{direction:"right",onClick:a,disabled:n>=t}),r.createElement(c.Z,{ml:1.5},n," of ",t))}var d=t(97716),p=t(10180),v=t(20115),f=t(13646),k=t(19344),g=t(43363),E=t(68981),h=t(19324),b=t(34314),N=function(e,n){return r.useMemo((function(){return null==e?e:n(e)}),[e,n])};var Z=function(e,n){var t=void 0===n?{}:n,a=t.getItemId,i=void 0===a?d.Z:a,l=t.perPage,o=void 0===l?10:l,c=t.onChange,u=r.useState(1),s=u[0],m=u[1],Z=r.useState(o),y=Z[0],S=Z[1],C=Math.max(1,Math.ceil(e.length/y)),D=r.useMemo((function(){return k.Z(g.Z(1,C),m)}),[C,m]),R=r.useCallback((function(){return D(s+1)}),[D,s]),w=r.useCallback((function(){return D(s-1)}),[D,s]);(function(e,n){void 0===n&&(n=d.Z);var t=N(e,n),a=(0,b.Z)(e),r=N(a,n);return p.Z(Array,t)&&p.Z(Array,r)?!v.Z(r,t):!f.Z(t,r)})(e,N(i,E.Z))&&1!==s&&D(1);var F=(s-1)*y,T=r.useMemo((function(){return h.Z(F,F+y)}),[F,y]),A=N(e,T);return(0,b.Z)(y,(function(e){e&&y!==e&&D(Math.floor((s-1)*e/y)+1)})),(0,b.Z)(s,(function(e){s!==e&&c&&c(e,s)})),{paginated:A,total:e.length,from:F+1,to:F+y,perPage:y,setPerPage:S,page:s,pages:C,nextPage:R,prevPage:w,goToPage:D}}},77246:(e,n,t)=>{t.d(n,{Pl:()=>R,o8:()=>T,Fb:()=>A,im:()=>x,xS:()=>M,Ex:()=>O,tl:()=>U});var a=t(70655),r=t(94184),i=t.n(r),l=t(43393),o=t(19344),c=t(57438),u=t(97716),s=t(51826),m=t(67294),d=t(868),p=t(17812),v=t(41120),f=t(28358),k=t(22318),g=t(83750),E=t(57394),h=t(88222),b=t(13258),N=t(77256),Z=t(95477),y=t(61657),S=t(59114),C=t(9001),D=function(e){return"asc"===e?"desc":"asc"};function R(e){var n=e.rows,t=(0,a._T)(e,["rows"]),r=m.useState(t.column),i=r[0],l=r[1],d=m.useState(t.direction||"asc"),p=d[0],v=d[1],f=i.sortBy||i.getValue,k=m.useMemo((function(){return o.Z(c.Z(f),"asc"===p?u.Z:s.Z)}),[f,p]),g=(0,C.Z)([k,n],(function(){return k(n)})),E=m.useCallback((function(e){i!==e?(l(e),v("asc")):v(D)}),[i,l,v]);return{column:i,direction:p,change:E,ordered:g}}l.Set();var w=function(e){return e?m.createElement(d.ZP,{title:e.title,key:e.title},m.createElement(p.Z,{"aria-label":e.title,onClick:e.fn,href:e.href,component:e.href?"a":void 0,target:e.href?"_blank":void 0},e.icon)):null},F=v.Z((function(e){return{root:{paddingRight:e.spacing(1)},highlight:"light"===e.palette.type?{color:e.palette.secondary.main,backgroundColor:(0,S.$n)(e.palette.secondary.light,.85)}:{color:e.palette.text.primary,backgroundColor:e.palette.secondary.dark},spacer:{flex:"1 1 100%"},actions:{color:e.palette.text.secondary},title:{flex:"0 0 auto"}}}));function T(e){var n,t=e.heading,a=e.selected,r=void 0===a?0:a,l=e.actions,o=void 0===l?[]:l,c=e.selectedActions,u=void 0===c?[]:c,s=F();return m.createElement(f.Z,{className:i()(s.root,(n={},n[s.highlight]=r>0,n))},m.createElement("div",{className:s.title},r>0?m.createElement(k.Z,{color:"inherit",variant:"subtitle1"},r," selected"):m.createElement(k.Z,{variant:"h6"},t)),m.createElement("div",{className:s.spacer}),m.createElement("div",{className:s.actions},(r>0?u:o).map(w)))}function A(e){var n=e.columns,t=e.selection,a=void 0===t?void 0:t,r=e.ordering,i=e.withInlineActions,l=void 0!==i&&i;return m.createElement(g.Z,null,m.createElement(E.Z,null,!!a&&m.createElement(h.Z,{padding:"checkbox",onClick:a.toggleAll},m.createElement(b.Z,{indeterminate:a.selected.size>0&&a.selected.size<a.all.size,checked:a.selected.equals(a.all)})),n.map((function(e){return m.createElement(h.Z,{key:e.id,sortDirection:r.column===e&&r.direction,align:e.align},!1===e.sortable?e.label:m.createElement(d.ZP,{title:e.hint||"Sort",placement:"bottom-start",enterDelay:300},m.createElement(N.Z,{active:r.column===e,direction:r.direction,onClick:function(){return r.change(e)}},e.label)))})),l&&m.createElement(h.Z,{align:"right"},"Actions")))}var _=v.Z({root:{overflowX:"auto"}});function x(e){var n=e.className,t=void 0===n?void 0:n,r=(0,a._T)(e,["className"]),l=_();return m.createElement("div",(0,a.pi)({className:i()(l.root,t)},r))}var I=v.Z((function(e){return{root:{opacity:.3,paddingRight:e.spacing(1),textAlign:"right",transition:"opacity 100ms",whiteSpace:"nowrap","tr:hover &":{opacity:1}}}}));function M(e){var n=e.actions,t=void 0===n?[]:n,r=e.children,i=void 0===r?void 0:r,l=(0,a._T)(e,["actions","children"]),o=I();return m.createElement("div",(0,a.pi)({className:o.root},l),t.map(w),i)}var V=v.Z((function(e){return{root:{marginBottom:e.spacing(2),marginLeft:e.spacing(3)}}}));function O(e){var n=V();return m.createElement(Z.Z,(0,a.pi)({classes:n},e))}var P=v.Z((function(e){return{toolbar:{paddingRight:[e.spacing(1),"!important"]}}}));function U(e){var n=e.pagination,t=(0,a._T)(e,["pagination"]),r=P();return m.createElement(y.Z,(0,a.pi)({classes:r,component:"div",count:n.total,rowsPerPage:n.perPage,page:n.page-1,onChangePage:function(e,t){return n.goToPage(t+1)},onChangeRowsPerPage:function(e){return n.setPerPage(e.target.value)}},t))}},18055:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Qe});var a=t(67294),r=t(10529),i=t(46974),l=t(57156),o=t(28238),c=t(70655),u=t(95142),s=t(3735),m=t(32521),d=t(30601),p=t(70475),v=t(84792),f=t(68981),k=t(19344),g=t(62825),E=t(97716),h=t(66688),b=t(92432),N=t(41120),Z=t(66083),y=t(22318),S=t(29525),C=t(30553),D=t(13258),R=t(66037),w=t(66856),F=t(282),T=t(95477),A=t(39803),_=t(92863),x=t(79895),I=t(82302),M=t(99613),V=t(57394),O=t(88222),P=t(67456),U=t(56858),W=t(94998),J=t(23915),$=t(14194),q=t(31708),B=t(27304),L=t(16946),z=t(62803),G=t(13462),j=t(26209),X=t(868),Q=t(56847),Y=t(83750),H=t(70397),K=N.Z((function(e){return{bucket:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},button:{marginLeft:e.spacing(1)},cell:{minWidth:e.spacing(17.5)},row:{"&:last-child $cell":{borderBottom:0}}}}));function ee(e){var n=e.bucket,t=e.value,r=e.onChange,i=K(),l=a.useCallback((function(e){var t=$.Jx(U.GN)(e.target.value);r(n,t)}),[n,r]),o=U.GN.encode(t);return a.createElement(V.Z,{className:i.row},a.createElement(O.Z,{className:i.cell},a.createElement(y.Z,{className:i.bucket,variant:"body1"},n)),a.createElement(O.Z,{className:i.cell,align:"right"},a.createElement(j.Z,{native:!0,value:o,onChange:l},U.tL.map((function(e){return a.createElement("option",{key:e},e)})))))}var ne=N.Z((function(e){return{heading:{alignItems:"center",display:"flex"},icon:{marginLeft:e.spacing(.5)},caption:{color:e.palette.text.secondary},captionWrapper:{margin:e.spacing(.5,0,0)},cell:{minWidth:e.spacing(17.5)},container:{borderBottom:"1px solid "+e.palette.divider,marginTop:e.spacing(1),maxHeight:"calc(100vh - 500px)"}}}));function te(e){var n=e.className,t=e.input,r=t.value,i=t.onChange,l=e.onAdvanced,o=ne(),c=a.useCallback((function(e,n){var t=B.Z(L.Z("bucket",e),r);i(z.Z(t,G.Z("level",n),r))}),[r,i]);return a.createElement("div",{className:n},a.createElement("div",{className:o.heading},a.createElement(y.Z,{variant:"h6"},"Bucket access"),a.createElement(X.ZP,{arrow:!0,title:a.createElement(a.Fragment,null,"Admin users can see all the buckets, but can only access the contents of the buckets according to their assigned role. Regular users can only see the buckets configured in their assigned role.")},a.createElement(_.Z,{fontSize:"small",color:"disabled",className:o.icon},"info_outlined"))),!!l&&a.createElement("p",{className:o.captionWrapper},a.createElement(y.Z,{className:o.caption,variant:"caption"},"Manage access using per-bucket permissions or"," ",a.createElement(H.Z,{onClick:l},"set existing role via ARN"))),a.createElement(Q.Z,{className:o.container},a.createElement(I.Z,{stickyHeader:!0,size:"small"},a.createElement(Y.Z,null,a.createElement(V.Z,null,a.createElement(O.Z,{className:o.cell},"Bucket name"),a.createElement(O.Z,{className:o.cell,align:"right"},"Permissions"))),a.createElement(M.Z,null,r.map((function(e){var n=e.bucket,t=e.level;return a.createElement(ee,{key:n,bucket:n,value:t,onChange:c})}))))))}function ae(e){var n=e.input,t=e.meta,r=e.errors,i=e.helperText,l=(0,c._T)(e,["input","meta","errors","helperText"]),o=t.submitFailed&&(t.error||t.submitError),u=(0,c.pi)((0,c.pi)({error:!!o,helperText:o?r[o]||o:i,disabled:t.submitting||t.submitSucceeded},n),l);return a.createElement(A.Z,(0,c.pi)({},u))}var re=N.Z((function(e){return{root:{marginTop:e.spacing(3),"& a":{textDecoration:"underline"}}}}));function ie(e){var n=e.error,t=e.errors,r=(0,c._T)(e,["error","errors"]),i=re();return n?a.createElement(y.Z,(0,c.pi)({color:"error",classes:i},r),t[n]||n):null}var le=t(77246),oe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"containers_Admin_RolesBuckets"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"buckets"},name:{kind:"Name",value:"bucketConfigs"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}}]}}]}}]},ce=[{kind:"FragmentDefinition",name:{kind:"Name",value:"RoleSelection"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Role"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"UnmanagedRole"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"arn"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ManagedRole"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"arn"}},{kind:"Field",name:{kind:"Name",value:"permissions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"bucket"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}}]}},{kind:"Field",name:{kind:"Name",value:"level"}}]}}]}}]}}],ue={kind:"Document",definitions:(0,c.ev)([{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"containers_Admin_RolesRoles"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"roles"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"RoleSelection"}}]}}]}}],ce,!0)},se={kind:"Document",definitions:(0,c.ev)([{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"containers_Admin_RolesCreateManaged"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ManagedRoleInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"roleCreate"},name:{kind:"Name",value:"roleCreateManaged"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"RoleCreateSuccess"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"role"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"RoleSelection"}}]}}]}}]}}]}}],ce,!0)},me={kind:"Document",definitions:(0,c.ev)([{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"containers_Admin_RolesCreateUnmanaged"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UnmanagedRoleInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"roleCreate"},name:{kind:"Name",value:"roleCreateUnmanaged"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"RoleCreateSuccess"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"role"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"RoleSelection"}}]}}]}}]}}]}}],ce,!0)},de={kind:"Document",definitions:(0,c.ev)([{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"containers_Admin_RolesUpdateManaged"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ManagedRoleInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"roleUpdate"},name:{kind:"Name",value:"roleUpdateManaged"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"RoleUpdateSuccess"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"role"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"RoleSelection"}}]}}]}}]}}]}}],ce,!0)},pe={kind:"Document",definitions:(0,c.ev)([{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"containers_Admin_RolesUpdateUnmanaged"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UnmanagedRoleInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"roleUpdate"},name:{kind:"Name",value:"roleUpdateUnmanaged"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"RoleUpdateSuccess"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"role"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"RoleSelection"}}]}}]}}]}}]}}],ce,!0)},ve={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"containers_Admin_RolesDelete"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"roleDelete"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}}]},fe="https://console.aws.amazon.com/iam/home",ke=/^arn:aws:iam:[^:]*:\d+:role\/(.+)$/,ge=/^arn:aws:iam:[^:]*:\d+:policy\/(.+)$/,Ee=function(e){var n=(e.match(ke)||[])[1];return n?fe+"#/roles/"+n:(e.match(ge)||[])[1]?fe+"#/policies/"+e:void 0},he=[{id:"name",label:"Name",getValue:d.Z("name"),props:{component:"th",scope:"row"}},{id:"source",label:"Source",getValue:function(e){return"ManagedRole"===e.__typename},getDisplay:function(e){return e?a.createElement("abbr",{title:"This IAM role is created and managed by Quilt"},"Quilt"):a.createElement("abbr",{title:"This IAM role is provided and managed by you or another administrator"},"Custom")}},{id:"buckets",label:"Buckets",getValue:function(e){return"ManagedRole"===e.__typename?e.permissions.filter((function(e){return!!e.level})).length:null},getDisplay:function(e){return null==e?"N/A":e}}],be=N.Z((function(e){return{lock:{alignItems:"center",background:"rgba(255,255,255,0.9)",bottom:52,cursor:"not-allowed",display:"flex",flexDirection:"column",justifyContent:"center",left:0,position:"absolute",right:0,top:64,zIndex:3},title:{"&>*":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},panel:{marginTop:e.spacing(2)}}}));function Ne(e){var n=this,t=e.close,r=be(),i=b.Db(se)[1],l=b.Db(me)[1],o=P.D$().push,m=b.aM({query:oe})[0].data.buckets,d=a.useState(!0),k=d[0],g=d[1],E=a.useCallback((function(e){return(0,c.mG)(n,void 0,void 0,(function(){var n,a,r,s,m;return(0,c.Jh)(this,(function(c){switch(c.label){case 0:return c.trys.push([0,5,,6]),n=void 0,k?(a=p.Z(Ce)(e),[4,i({input:a})]):[3,2];case 1:return n=c.sent(),[3,4];case 2:return a=p.Z(ye)(e),[4,l({input:a})];case 3:n=c.sent(),c.label=4;case 4:if(n.error)throw n.error;if(!n.data)throw new Error("No data");switch((r=n.data.roleCreate).__typename){case"RoleCreateSuccess":return o('Role "'+r.role.name+'" created'),t(),[2,void 0];case"RoleNameReserved":return[2,{name:"reserved"}];case"RoleNameExists":return[2,{name:"taken"}];case"RoleNameInvalid":return[2,{name:"invalid"}];case"BucketConfigDoesNotExist":throw new Error(r.__typename);default:return[2,(0,J.Z)(r)]}return[3,6];case 5:return s=c.sent(),console.error("Error creating role"),console.error(s),[2,(m={},m[u.Ck]="unexpected",m)];case 6:return[2]}}))}))}),[k,i,l,o,t]),N=a.useMemo((function(){return s.zG(m,v.Z((function(e,n){return e.name.localeCompare(n.name)})),f.Z((function(e){return{bucket:e.name,level:null}})))}),[m]);return a.createElement(h.l0,{onSubmit:E,initialValues:{permissions:N}},(function(e){var n=e.handleSubmit,i=e.submitting,l=e.submitFailed,o=e.error,c=e.hasValidationErrors,u=e.submitError;return a.createElement(a.Fragment,null,a.createElement(Z.Z,{disableTypography:!0},a.createElement(y.Z,{variant:"h5"},"Create a role")),a.createElement(S.Z,null,a.createElement("form",{onSubmit:n},a.createElement(h.gN,{component:ae,name:"name",validate:q.C1,placeholder:"Enter role name",label:"Name",fullWidth:!0,margin:"normal",errors:{required:"Enter a role name",reserved:"This is a reserved name, please use another",taken:"Role with this name already exists",invalid:a.createElement(a.Fragment,null,"Enter a"," ",a.createElement("abbr",{title:"Must start with a letter and contain only alphanumeric characters and underscores thereafter"},"valid")," ","role name")}}),a.createElement(C.Z,{label:"Manually set ARN instead of configuring per-bucket permissions",control:a.createElement(D.Z,{checked:!k}),onChange:function(){return g(!k)}}),a.createElement(R.Z,{in:!k},a.createElement(h.gN,{component:ae,name:"arn",validate:function(e){return k?void 0:q.C1(e)},placeholder:"Enter role ARN",label:"ARN",fullWidth:!0,margin:"normal",disabled:k,errors:{required:"Enter an ARN"}})),a.createElement(R.Z,{in:k},a.createElement(h.gN,{className:r.panel,component:te,name:"permissions",fullWidth:!0,margin:"normal",onAdvanced:function(){return g(!1)}})),l&&a.createElement(ie,{error:o||u,errors:{unexpected:"Something went wrong"}}),a.createElement("input",{type:"submit",style:{display:"none"}}))),a.createElement(w.Z,null,a.createElement(F.Z,{onClick:function(){return t("cancel")},color:"primary",disabled:i},"Cancel"),a.createElement(F.Z,{onClick:n,color:"primary",disabled:i||l&&c},"Create")),i&&a.createElement("div",{className:r.lock},a.createElement(T.Z,{size:80})))}))}function Ze(e){var n=this,t=e.role,r=e.close,i=P.D$().push,l=b.Db(ve)[1],o=a.useCallback((function(){return(0,c.mG)(n,void 0,void 0,(function(){var e,n,a;return(0,c.Jh)(this,(function(o){switch(o.label){case 0:r(),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,l({id:t.id})];case 2:if((e=o.sent()).error)throw e.error;if(!e.data)throw new Error("No data");switch((n=e.data.roleDelete).__typename){case"RoleDeleteSuccess":case"RoleDoesNotExist":return[2];case"RoleNameReserved":return i('Unable to delete reserved role "'+t.name+'"'),[2];case"RoleAssigned":return i('Unable to delete role "'+t.name+'" assigned to some user(s). Unassign this role from everyone and try again.'),[2];default:(0,J.Z)(n)}return[3,4];case 3:return a=o.sent(),i('Error deleting role "'+t.name+'"'),console.error("Error deleting role"),console.error(a),[3,4];case 4:return[2]}}))}))}),[r,i,l,t.id,t.name]);return a.createElement(a.Fragment,null,a.createElement(Z.Z,null,"Delete a role"),a.createElement(S.Z,null,'You are about to delete the "',t.name,'" role. This operation is irreversible.'),a.createElement(w.Z,null,a.createElement(F.Z,{onClick:function(){return r("cancel")},color:"primary"},"Cancel"),a.createElement(F.Z,{onClick:o,color:"primary"},"Delete")))}var ye={name:k.Z(d.Z("name"),$.Jx(m.string),g.Z,$.Jx($.CM)),arn:k.Z(d.Z("arn"),$.Jx(m.string),g.Z,$.Jx($.CM))},Se=m.type({bucket:m.string,level:$.AG(U.F$)},"PermissionInput"),Ce={name:k.Z(d.Z("name"),$.Jx(m.string),g.Z,$.Jx($.CM)),permissions:k.Z(d.Z("permissions"),$.Jx(m.readonlyArray(Se)))};function De(e){var n=this,t=e.role,r=e.close,i=b.Db(de)[1],l=b.Db(pe)[1],o="ManagedRole"===t.__typename,s=a.useCallback((function(e){return(0,c.mG)(n,void 0,void 0,(function(){var n,a,s,m,d;return(0,c.Jh)(this,(function(c){switch(c.label){case 0:return c.trys.push([0,5,,6]),n=void 0,o?(a=p.Z(Ce)(e),[4,i({input:a,id:t.id})]):[3,2];case 1:return n=c.sent(),[3,4];case 2:return a=p.Z(ye)(e),[4,l({input:a,id:t.id})];case 3:n=c.sent(),c.label=4;case 4:if(n.error)throw n.error;if(!n.data)throw new Error("No data");switch((s=n.data.roleUpdate).__typename){case"RoleUpdateSuccess":return r(),[2,void 0];case"RoleNameReserved":return[2,{name:"reserved"}];case"RoleNameExists":return[2,{name:"taken"}];case"RoleNameInvalid":return[2,{name:"invalid"}];case"RoleIsManaged":case"RoleIsUnmanaged":case"BucketConfigDoesNotExist":throw new Error(s.__typename);default:return[2,(0,J.Z)(s)]}return[3,6];case 5:return m=c.sent(),console.error("Error updating role"),console.error(m),[2,(d={},d[u.Ck]="unexpected",d)];case 6:return[2]}}))}))}),[o,t.id,i,l,r]),m=be(),d=a.useMemo((function(){return{name:t.name,permissions:"ManagedRole"===t.__typename?t.permissions.map((function(e){return{bucket:e.bucket.name,level:e.level}})):[],arn:"UnmanagedRole"===t.__typename?t.arn:null}}),[t]),v=a.createElement(a.Fragment,null,"Edit"," ",o?a.createElement("abbr",{title:"This IAM role is created and managed by Quilt"},"Quilt"):a.createElement("abbr",{title:"This IAM role is provided and managed by you or another administrator"},"custom")," ",'role "',t.name,'"'),f="Edit "+(o?"Quilt":"custom")+' role "'+t.name+'"';return a.createElement(h.l0,{onSubmit:s,initialValues:d},(function(e){var n=e.handleSubmit,i=e.submitting,l=e.submitFailed,c=e.error,u=e.pristine,s=e.hasValidationErrors,d=e.submitError;return a.createElement(a.Fragment,null,a.createElement(Z.Z,{className:m.title,title:f},v),a.createElement(S.Z,null,a.createElement("form",{onSubmit:n},a.createElement(h.gN,{component:ae,name:"name",validate:q.C1,placeholder:"Enter role name",label:"Name",fullWidth:!0,margin:"normal",errors:{required:"Enter a role name",reserved:"This is a reserved name, please use another",taken:"Role with this name already exists",invalid:"Invalid name for role"}}),o?a.createElement(a.Fragment,null,a.createElement(A.Z,{value:t.arn,label:"ARN",fullWidth:!0,margin:"normal",disabled:!0}),a.createElement(h.gN,{className:m.panel,component:te,name:"permissions",fullWidth:!0,margin:"normal"})):a.createElement(h.gN,{component:ae,name:"arn",validate:q.C1,placeholder:"Enter role ARN",label:"ARN",fullWidth:!0,margin:"normal",errors:{required:"Enter an ARN"}}),l&&a.createElement(ie,{error:c||d,errors:{unexpected:"Something went wrong"}}),a.createElement("input",{type:"submit",style:{display:"none"}}))),a.createElement(w.Z,null,a.createElement(F.Z,{onClick:function(){return r("cancel")},color:"primary",disabled:i},"Cancel"),a.createElement(F.Z,{onClick:n,color:"primary",disabled:u||i||l&&s},"Save")),i&&a.createElement("div",{className:m.lock},a.createElement(T.Z,{size:80})))}))}function Re(){var e=b.aM({query:ue})[0].data.roles,n=le.Pl({rows:e,column:he[0]}),t=W.D(),r=[{title:"Create",icon:a.createElement(_.Z,null,"add"),fn:a.useCallback((function(){t.open((function(e){var n=e.close;return a.createElement(Ne,(0,c.pi)({},{close:n}))}))}),[t.open])}];return a.createElement(a.Suspense,{fallback:a.createElement(x.Z,null,a.createElement(le.o8,{heading:"Roles"}),a.createElement(le.Ex,null))},a.createElement(x.Z,null,t.render({fullWidth:!0,maxWidth:"sm"}),a.createElement(le.o8,{heading:"Roles",actions:r}),a.createElement(le.im,null,a.createElement(I.Z,null,a.createElement(le.Fb,{columns:he,ordering:n,withInlineActions:!0}),a.createElement(M.Z,null,n.ordered.map((function(e){return a.createElement(V.Z,{hover:!0,key:e.id},he.map((function(n){return a.createElement(O.Z,(0,c.pi)({key:n.id},n.props),(n.getDisplay||E.Z)(n.getValue(e)))})),a.createElement(O.Z,{align:"right",padding:"none"},a.createElement(le.xS,{actions:(n=e,[n.arn?{title:"Open AWS Console",icon:a.createElement(_.Z,null,"launch"),href:Ee(n.arn)}:null,{title:"Delete",icon:a.createElement(_.Z,null,"delete"),fn:function(){t.open((function(e){var t=e.close;return a.createElement(Ze,(0,c.pi)({},{role:n,close:t}))}))}},{title:"Edit",icon:a.createElement(_.Z,null,"edit"),fn:function(){t.open((function(e){var t=e.close;return a.createElement(De,(0,c.pi)({},{role:n,close:t}))}))}}])})));var n})))))))}var we=t(94184),Fe=t.n(we),Te=t(61889),Ae=t(66115),_e=t(85639),xe=t(9570),Ie=t(22966),Me=t(98763),Ve=t(21587),Oe=o.SN({name:"Admin.data.users",fetch:function(e){return(0,e.req)({endpoint:"/users/list"}).then(k.Z(d.Z("results"),f.Z((function(e){return{dateJoined:new Date(e.date_joined),email:e.email,isActive:e.is_active,isAdmin:e.is_superuser,lastLogin:new Date(e.last_login),username:e.username,roleId:e.role_id}}))))},key:function(){return null}}),Pe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"containers_Admin_UsersRoles"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"roles"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"UnmanagedRole"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ManagedRole"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}}]}}]}}]}}]},Ue=N.Z((function(e){return{root:{fontFamily:e.typography.monospace.fontFamily}}}));function We(e){var n=e.className,t=e.children,r=Ue();return a.createElement("span",{className:Fe()(n,r.root)},t)}function Je(e){var n=this,t=e.close,r=e.roles,l=i.D$(),u=o.D$(),s=P.D$().push,m=a.useCallback((function(e){var a=e.username,o=e.email,m=e.roleId;return(0,c.mG)(n,void 0,void 0,(function(){var e,n,d,p,v,f;return(0,c.Jh)(this,(function(c){switch(c.label){case 0:e=r.find((function(e){return e.id===m})),c.label=1;case 1:return c.trys.push([1,7,,8]),[4,l({endpoint:"/users/create",method:"POST",body:JSON.stringify({username:a,email:o})})];case 2:c.sent(),n={dateJoined:new Date,email:o,isActive:!0,isAdmin:!1,lastLogin:new Date,username:a},c.label=3;case 3:return c.trys.push([3,5,,6]),[4,l({method:"POST",endpoint:"/users/set_role",body:JSON.stringify({username:a,role:e.name})})];case 4:return c.sent(),n.roleId=e.id,[3,6];case 5:return d=c.sent(),console.error("Error setting role",{username:a,role:e}),console.dir(d),[3,6];case 6:return u.patchOk(Oe,null,Te.Z(n)),s("User invited"),t(),[3,8];case 7:return p=c.sent(),i.Bb.is(p,400,/Username is not valid/)?[2,{username:"invalid"}]:i.Bb.is(p,409,/Username already taken/)?[2,{username:"taken"}]:i.Bb.is(p,400,/Invalid email/)?[2,{email:"invalid"}]:i.Bb.is(p,409,/Email already taken/)?[2,{email:"taken"}]:i.Bb.is(p,500,/SMTP.*invalid/)?[2,(v={},v[FF.FORM_ERROR]="smtp",v)]:(console.error("Error creating user"),console.dir(p),[2,(f={},f[FF.FORM_ERROR]="unexpected",f)]);case 8:return[2]}}))}))}),[l,u,s,t,r]);return a.createElement(h.l0,{onSubmit:m,initialValues:{roleId:r[0].id}},(function(e){var n=e.handleSubmit,i=e.submitting,l=e.submitFailed,o=e.error,c=e.hasSubmitErrors,u=e.hasValidationErrors,s=e.modifiedSinceLastSubmit;return a.createElement(a.Fragment,null,a.createElement(Z.Z,null,"Invite a user"),a.createElement(S.Z,null,a.createElement("form",{onSubmit:n},a.createElement(h.gN,{component:Ve.gN,name:"username",validate:q.C1,label:"Username",fullWidth:!0,margin:"normal",errors:{required:"Enter a username",taken:"Username already taken",invalid:a.createElement("span",null,"Enter a"," ",a.createElement("abbr",{title:"Must start with a letter or underscore, and contain only alphanumeric characters and underscores thereafter"},"valid")," ","username")},autoComplete:"off"}),a.createElement(h.gN,{component:Ve.gN,name:"email",validate:q.C1,label:"Email",fullWidth:!0,margin:"normal",errors:{required:"Enter an email",taken:"Email already taken",invalid:"Enter a valid email"},autoComplete:"off"}),a.createElement(h.gN,{component:Ve.gN,name:"roleId",label:"Role",select:!0,fullWidth:!0,margin:"normal"},r.map((function(e){return a.createElement(_e.Z,{value:e.id,key:e.id},e.name)}))),l&&a.createElement(Ve.Xq,{error:o,errors:{unexpected:"Something went wrong",smtp:"SMTP error: contact your administrator"}}),a.createElement("input",{type:"submit",style:{display:"none"}}))),a.createElement(w.Z,null,a.createElement(F.Z,{onClick:function(){return t("cancel")},color:"primary",disabled:i},"Cancel"),a.createElement(F.Z,{onClick:n,color:"primary",disabled:i||u&&l||c&&!s},"Invite")))}))}function $e(e){var n=this,t=e.close,r=e.user,l=r.email,u=r.username,s=i.D$(),m=o.D$(),d=P.D$().push,p=a.useCallback((function(e){var a=e.email;return(0,c.mG)(n,void 0,void 0,(function(){var e,n;return(0,c.Jh)(this,(function(r){switch(r.label){case 0:if(a===l)return t(),[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,s({endpoint:"/users/edit_email",method:"POST",body:JSON.stringify({username:u,email:a})})];case 2:return r.sent(),m.patchOk(Oe,null,f.Z((function(e){return e.username===u?(0,c.pi)((0,c.pi)({},e),{email:a}):e}))),d("Changes saved"),t(),[3,4];case 3:return e=r.sent(),i.Bb.is(e,400,/Another user already has that email/)?[2,{email:"taken"}]:i.Bb.is(e,400,/Invalid email/)?[2,{email:"invalid"}]:(console.error("Error changing email"),console.dir(e),[2,(n={},n[FF.FORM_ERROR]="unexpected",n)]);case 4:return[2]}}))}))}),[t,u,l,s,m,d]);return a.createElement(h.l0,{onSubmit:p,initialValues:{email:l}},(function(e){var n=e.handleSubmit,r=e.submitting,i=e.submitFailed,l=e.error,o=e.hasSubmitErrors,c=e.hasValidationErrors,s=e.modifiedSinceLastSubmit;return a.createElement(a.Fragment,null,a.createElement(Z.Z,null,'Edit user: "',u,'"'),a.createElement(S.Z,null,a.createElement("form",{onSubmit:n},a.createElement(h.gN,{component:Ve.gN,name:"email",validate:q.C1,label:"Email",fullWidth:!0,margin:"normal",errors:{required:"Enter an email",taken:"Email already taken",invalid:"Enter a valid email"},autoComplete:"off"}),i&&a.createElement(Ve.Xq,{error:l,errors:{unexpected:"Something went wrong"}}),a.createElement("input",{type:"submit",style:{display:"none"}}))),a.createElement(w.Z,null,a.createElement(F.Z,{onClick:function(){return t("cancel")},color:"primary",disabled:r},"Cancel"),a.createElement(F.Z,{onClick:n,color:"primary",disabled:r||c&&i||o&&!s},"Save")))}))}function qe(e){var n=e.user,t=e.close,r=i.D$(),l=o.D$(),c=P.D$().push,u=a.useCallback((function(){t(),r({endpoint:"/users/delete",method:"POST",body:JSON.stringify({username:n.username})}).then((function(){c('User "'+n.username+'" deleted')})).catch((function(e){l.patchOk(Oe,null,Te.Z(n)),c('Error deleting user "'+n.username+'"'),console.error("Error deleting user"),console.dir(e)})),l.patchOk(Oe,null,Ae.Z(L.Z("username",n.username)))}),[n,t,r,l,c]);return a.createElement(a.Fragment,null,a.createElement(Z.Z,null,"Delete a user"),a.createElement(S.Z,null,'You are about to delete user "',n.username,'". This operation is irreversible.'),a.createElement(w.Z,null,a.createElement(F.Z,{onClick:function(){return t("cancel")},color:"primary"},"Cancel"),a.createElement(F.Z,{onClick:u,color:"primary"},"Delete")))}function Be(e){var n=e.username,t=e.admin,r=e.close,l=i.D$(),u=o.D$(),s=P.D$().push,m=a.useCallback((function(){return r(l({method:"POST",endpoint:"/users/"+(t?"grant":"revoke")+"_admin",body:JSON.stringify({username:n})}).then((function(){return u.patchOk(Oe,null,f.Z((function(e){return e.username===n?(0,c.pi)((0,c.pi)({},e),{isAdmin:t}):e}))),"ok"})).catch((function(e){throw s("Error "+(t?"granting":"revoking")+' admin status for "'+n+'"'),console.error("Error changing user admin status",{username:n,admin:t}),console.dir(e),e})))}),[t,r,n,l,u,s]);return a.createElement(a.Fragment,null,a.createElement(Z.Z,null,t?"Grant":"Revoke"," admin rights"),a.createElement(S.Z,null,"You are about to ",t?"grant admin rights to":"revoke admin rights from"," ",'"',n,'".'),a.createElement(w.Z,null,a.createElement(F.Z,{onClick:function(){return r("cancel")},color:"primary"},"Cancel"),a.createElement(F.Z,{onClick:m,color:"primary"},t?"Grant":"Revoke")))}var Le=N.Z((function(e){return{root:{alignItems:"center",display:"flex"},admin:{fontWeight:600},icon:{fontSize:"1em",marginLeft:"calc(-1em - "+e.spacing(.5)+"px)",marginRight:e.spacing(.5)}}}));function ze(e){var n,t=e.className,r=e.admin,i=void 0!==r&&r,l=e.children,o=(0,c._T)(e,["className","admin","children"]),u=Le();return a.createElement("span",(0,c.pi)({className:Fe()(t,u.root)},o),i&&a.createElement(_.Z,{className:u.icon},"security"),a.createElement(We,{className:Fe()((n={},n[u.admin]=i,n))},l))}function Ge(e){var n=e.value,t=e.onChange,r=e.children,i=a.useState(!1),l=i[0],o=i[1],c=a.useState(n),u=c[0],s=c[1];return r({change:a.useCallback((function(e){u!==e&&(l||(o(!0),s(e),Promise.resolve(t(e)).then((function(){o(!1)})).catch((function(e){throw s(u),o(!1),e}))))}),[t,l,o,u,s]),busy:l,value:u})}function je(){return a.createElement(x.Z,null,a.createElement(le.o8,{heading:"Users"}),a.createElement(le.Ex,null))}function Xe(e){var n=this,t=e.users,r=o.Rq(t),l=b.aM({query:Pe})[0].data.roles,u=i.D$(),s=o.D$(),m=P.D$().push,p=W.D(),v=p.open,k=a.useCallback((function(e,n){return u({method:"POST",endpoint:"/users/set_role",body:JSON.stringify({username:e,role:n})}).then((function(){s.patchOk(Oe,null,f.Z((function(t){return t.username===e?(0,c.pi)((0,c.pi)({},t),{role:n}):t})))})).catch((function(t){throw m('Error changing role for "'+e+'"'),console.error("Error chaging role",{username:e,role:n}),console.dir(t),t}))}),[u,s,m]),g=a.useCallback((function(e,n){return u({method:"POST",endpoint:"/users/"+(n?"enable":"disable"),body:JSON.stringify({username:e})}).then((function(){s.patchOk(Oe,null,f.Z((function(t){return t.username===e?(0,c.pi)((0,c.pi)({},t),{isActive:n}):t})))})).catch((function(t){throw m("Error "+(n?"enabling":"disabling")+' "'+e+'"'),console.error("Error (de)activating user",{username:e,active:n}),console.dir(t),t}))}),[u,s,m]),h=a.useMemo((function(){return[{id:"isActive",label:"Enabled",getValue:d.Z("isActive"),getDisplay:function(e,n){return a.createElement(Ge,{value:e,onChange:function(e){return g(n.username,e)}},(function(e){var n=e.change,t=e.busy,r=e.value;return a.createElement(xe.Z,{checked:r,onChange:function(e){return n(e.target.checked)},disabled:t,color:"default"})}))}},{id:"username",label:"Username",getValue:d.Z("username"),getDisplay:function(e,n){return a.createElement(ze,{admin:n.isAdmin},e)},props:{component:"th",scope:"row"}},{id:"email",label:"Email",getValue:d.Z("email")},{id:"role",label:"Role",getValue:function(e){return e.roleId&&(l.find((function(n){return n.id===e.roleId}))||{}).name},getDisplay:function(e,n){return a.createElement(Ge,{value:e,onChange:function(e){return k(n.username,e)}},(function(e){var n=e.change,t=e.busy,r=e.value;return a.createElement(j.Z,{value:r||"<None>",onChange:function(e){return n(e.target.value)},disabled:t,renderValue:E.Z},l.map((function(e){return a.createElement(_e.Z,{value:e.name,key:e.id},e.name)})))}))}},{id:"dateJoined",label:"Date joined",getValue:d.Z("dateJoined"),getDisplay:function(e){return a.createElement("span",{title:e.toString()},a.createElement(Me.Ig,{value:e}))}},{id:"lastLogin",label:"Last login",getValue:d.Z("lastLogin"),getDisplay:function(e){return a.createElement("span",{title:e.toString()},a.createElement(Me.Ig,{value:e}))}},{id:"isAdmin",label:"Admin",hint:"Admins can see this page, add/remove users, and make/remove admins",getValue:d.Z("isAdmin"),getDisplay:function(e,t){return a.createElement(Ge,{value:e,onChange:function(e){return(0,c.mG)(n,void 0,void 0,(function(){return(0,c.Jh)(this,(function(n){switch(n.label){case 0:return[4,v((function(n){var r=n.close;return a.createElement(Be,(0,c.pi)({},{close:r,admin:e,username:t.username}))}))];case 1:if("ok"!==n.sent())throw new Error("cancelled");return[2]}}))}))}},(function(e){var n=e.change,t=e.busy,r=e.value;return a.createElement(xe.Z,{checked:r,onChange:function(e){return n(e.target.checked)},disabled:t,color:"default"})}))}}]}),[l,v,g,k]),N=le.Pl({rows:r,column:h[0]}),Z=Ie.D$(N.ordered,{getItemId:d.Z("username")}),y=[{title:"Invite",icon:a.createElement(_.Z,null,"add"),fn:a.useCallback((function(){v((function(e){var n=e.close;return a.createElement(Je,(0,c.pi)({},{close:n,roles:l}))}))}),[l,v])}];return a.createElement(a.Suspense,{fallback:a.createElement(je,null)},a.createElement(x.Z,null,p.render({maxWidth:"xs",fullWidth:!0}),a.createElement(le.o8,{heading:"Users",actions:y}),a.createElement(le.im,null,a.createElement(I.Z,{size:"small"},a.createElement(le.Fb,{columns:h,ordering:N,withInlineActions:!0}),a.createElement(M.Z,null,Z.paginated.map((function(e){return a.createElement(V.Z,{hover:!0,key:e.username},h.map((function(n){return a.createElement(O.Z,(0,c.pi)({key:n.id},n.props),(n.getDisplay||E.Z)(n.getValue(e),e))})),a.createElement(O.Z,{align:"right",padding:"none"},a.createElement(le.xS,{actions:(n=e,[{title:"Delete",icon:a.createElement(_.Z,null,"delete"),fn:function(){p.open((function(e){var t=e.close;return a.createElement(qe,(0,c.pi)({},{user:n,close:t}))}))}},{title:"Edit",icon:a.createElement(_.Z,null,"edit"),fn:function(){p.open((function(e){var t=e.close;return a.createElement($e,(0,c.pi)({},{user:n,close:t}))}))}}])})));var n}))))),a.createElement(le.tl,{pagination:Z})))}function Qe(){var e=i.D$(),n=o.et(Oe,{req:e});return a.createElement(a.Fragment,null,a.createElement(l.Z,null,["Users and Roles","Admin"]),a.createElement(r.Z,{mt:2},a.createElement(Xe,{users:n})),a.createElement(r.Z,{mt:2,mb:2},a.createElement(Re,null)))}},94998:(e,n,t)=>{t.d(n,{D:()=>o});var a=t(70655),r=t(67294),i=t(84170),l=t(17228),o=function(){var e=r.useState("closed"),n=e[0],t=e[1],o=r.useState(null),c=o[0],u=o[1],s=r.useCallback((function(e,n){var a=(0,l.Z)(),r=a.resolver,i=a.promise;return u({render:e,props:n,resolver:r}),t("open"),i}),[u,t]),m=r.useCallback((function(e){c&&c.resolver.resolve(e),t("closing")}),[t,c]),d=r.useCallback((function(){"closing"===n&&(t("closed"),u(null))}),[n,t,u]);return{open:s,render:function(e){return r.createElement(i.Z,(0,a.pi)({open:"open"===n,onClose:m,onExited:d},e,c&&c.props),c?c.render({close:m}):"")}}}}}]);
//# sourceMappingURL=8055.fa8835c75e08a60a463f.chunk.js.map